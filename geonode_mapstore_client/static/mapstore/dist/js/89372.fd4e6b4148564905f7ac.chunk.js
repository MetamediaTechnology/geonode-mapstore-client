(self.webpackChunkgeonode_mapstore_client=self.webpackChunkgeonode_mapstore_client||[]).push([[89372],{993451:(e,r,t)=>{"use strict";t.d(r,{Z:()=>w});var n=t(86638),o=t(675263),l=t.n(o),a=t(984596),i=t.n(a),u=t(701469),c=t.n(u),s=t(414293),y=t.n(s),f=t(747037),p=t.n(f),d=t(867076),g=["messages"];function m(e,r){if(null==e)return{};var t,n,o=function(e,r){if(null==e)return{};var t,n,o={},l=Object.keys(e);for(n=0;n<l.length;n++)t=l[n],r.indexOf(t)>=0||(o[t]=e[t]);return o}(e,r);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(n=0;n<l.length;n++)t=l[n],r.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(o[t]=e[t])}return o}function b(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,n)}return t}function h(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?b(Object(t),!0).forEach((function(r){v(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):b(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}function v(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}var O=function(e,r){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"label";if(c()(r))return r.map((function(o){var l=(0,n.S$)(e,o[t]||p()(o)&&o||"");return h(h({},o),{},v({},t,y()(l)?r:l))}));var o=(0,n.S$)(e,r);return y()(o)?r:o},E=function(e,r,t){return function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=arguments.length>1?arguments[1]:void 0;return h(h({},n),{},v({},o,e[o]&&O(r,e[o],t)))}};const w=function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"label";return(0,d.compose)((0,d.getContext)({messages:l().object}),(0,d.mapProps)((function(t){var n=t.messages,o=m(t,g);return h(h({},o),i()(e).reduce(E(o,n,r),{}))})))}},889372:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>ge});var n=t(675263),o=t.n(n),l=t(124852),a=t.n(l),i=t(171703),u=t(727418),c=t.n(u),s=t(227361),y=t.n(s),f=t(607147),p=t(782904),d=t(22222),g=t(757588),m=t(807472),b=t(743129),h=t(441609),v=t.n(h);function O(){return O=Object.assign?Object.assign.bind():function(e){for(var r=1;r<arguments.length;r++){var t=arguments[r];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e},O.apply(this,arguments)}function E(e,r){return function(e){if(Array.isArray(e))return e}(e)||function(e,r){var t=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=t){var n,o,l=[],a=!0,i=!1;try{for(t=t.call(e);!(a=(n=t.next()).done)&&(l.push(n.value),!r||l.length!==r);a=!0);}catch(e){i=!0,o=e}finally{try{a||null==t.return||t.return()}finally{if(i)throw o}}return l}}(e,r)||function(e,r){if(e){if("string"==typeof e)return w(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?w(e,r):void 0}}(e,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function w(e,r){(null==r||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}var x=(0,t(993451).Z)(["placeholder","clearValueText","noResultsText"])(b.ZP),L=function(e){var r=e.responses,t=e.index,n=e.setIndex,o=E((0,l.useState)([]),2),i=o[0],u=o[1],c=E((0,l.useState)(""),2),s=c[0],y=c[1];return(0,l.useEffect)((function(){v()(r)||u(r.map((function(e,r){var t=(null==e?void 0:e.title)||(null==e?void 0:e.name);return{label:t,value:t,idx:r,style:{display:"block"}}})))}),[r]),(0,l.useEffect)((function(){var e,n;y((null===(e=r[t])||void 0===e?void 0:e.title)||(null===(n=r[t])||void 0===n?void 0:n.name)||"")}),[r,t]),a().createElement("div",{id:"identify-layer-select",style:{flex:"1 1 0%"}},a().createElement(x,O({},{clearable:!1,isSearchable:!0},{onChange:function(e){var r=(null==e?void 0:e.idx)||0;n(r)},value:s||"",options:i,noResultsText:"identifyLayerSelectNoResult"})))};L.defaultProps={responses:[],index:-1},L.propTypes={responses:o().array,setIndex:o().func,index:o().number};const j=L;var S=t(675110),I=t(805346),P="MERGELYR:SET_LAYER_1",C="MERGELYR:SET_LAYER_2",A="MERGELYR:DO_MERGE",R="MERGELYR:SET_LOADING",M="MERGELYR:ADD_AS_LAYER",_="MERGELYR:FETCH_FAILURE",D="TOGGLE_CONTROL",T=function(e){return{type:P,index1:e}},k=function(e){return{type:C,index2:e}},G=function(e){return{type:R,isLoading:e}},Z=function(e){return{type:_,error:e}},N={layerIndex1:-1,layerIndex2:-1,loading:!1,error:""},F=t(375875),Y=t.n(F),B=t(49977),W=t.n(B),$=t(423570),U=t.n($),q=t(47805),H=t(580416);function J(e){return function(e){if(Array.isArray(e))return Q(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,r){if(e){if("string"==typeof e)return Q(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?Q(e,r):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Q(e,r){(null==r||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}var V=function(e){return new Promise((function(r,t){var n={service:"WFS",version:e.version,request:"GetFeature",typeName:e.name,outputFormat:"application/json"};if(e.layerFilter){var o=(0,q.toCQLFilter)(null==e?void 0:e.layerFilter);n.cql_filter=o}r(Y().get("".concat(e.url||"/geoserver/wfs"),{params:n})),t((function(e){e(Z(a().createElement(I.Z,{msgId:"mergeLayerPlugin.errorFetch"})))}))}))},X=function(e,r){for(var t=[["point","point"],["linestring","linestring"],["polygon","polygon"],["multipoint","multipoint"],["multilinestring","multilinestring"],["multipolygon","multipolygon"],["point","multipoint"],["multipoint","point"],["multilinestring","linestring"],["linestring","multilinestring"],["multipolygon","polygon"],["polygon","multipolygon"]],n=0;n<t.length;n++)if(t[n][0]===(null==e?void 0:e.toLowerCase())&&t[n][1]===(null==r?void 0:r.toLowerCase()))return!0;return!1},z=function(e){for(var r=JSON.parse(JSON.stringify(e)),t=[],n=0;n<r.features.length;n++)for(var o=0;o<r.features[n].features.length;o++)t.push(r.features[n].features[o]);return t.forEach((function(e){return delete e.style})),t},K="",ee="",re=function(e,r){return K=(null==e?void 0:e.title)||(null==e?void 0:e.name)||void 0,ee=(null==r?void 0:r.title)||(null==r?void 0:r.name)||void 0,e&&r?K===ee?function(e){e(Z(a().createElement(I.Z,{msgId:"mergeLayerPlugin.sameLayers"})))}:function(t){var n=function(e,r,n){if(e){for(var o=0;o<r.length;o++)for(var l=0;l<n.length;l++)if(r[o].id===n[l].id)return t(Z(a().createElement(I.Z,{msgId:"mergeLayerPlugin.haveLayerAlready"}))),void t(G(!1));var i={type:"FeatureCollection",features:[].concat(J(r),J(n))};t({type:M,featureCollection:i}),t(Z("succeed")),t(T(-1)),t(k(-1)),t(G(!1))}else t(Z("'".concat(r[0].geometry.type,"' - '").concat(n[0].geometry.type,"' type can't be merged"))),t(G(!1))};if(t(G(!0)),t(Z("")),e.features&&r.features){var o=e.features,l=r.features;"Annotations"===K&&(o=z(e)),"Annotations"===ee&&(l=z(r)),n(X(o[0].geometry.type,l[0].geometry.type),o,l)}else if(!e.features&&r.features)V(e).then((function(e){var t=e.data.features,o=r.features;"Annotations"===ee&&(o=z(r)),n(X(t[0].geometry.type,o[0].geometry.type),t,o)})).catch((function(e){console.error(e),t(Z(a().createElement(I.Z,{msgId:"mergeLayerPlugin.errorGetFeature1"}))),t(G(!1))}));else if(e.features&&!r.features)V(r).then((function(r){var t=e.features,o=r.data.features;"Annotations"===K&&(t=z(e)),n(X(t[0].geometry.type,o[0].geometry.type),t,o)})).catch((function(e){console.error(e),t(Z(a().createElement(I.Z,{msgId:"mergeLayerPlugin.errorGetFeature2"}))),t(G(!1))}));else{var i=V(e),u=V(r);Promise.all([i,u]).then((function(e){var r=e[0].data.features,t=e[1].data.features;n(X(r[0].geometry.type,t[0].geometry.type),r,t)})).catch((function(e){console.error(e),t(Z(a().createElement(I.Z,{msgId:"mergeLayerPlugin.errorAllGetFeature"}))),t(G(!1))}))}}:function(e){e(Z(a().createElement(I.Z,{msgId:"mergeLayerPlugin.noBothLayers"})))}};function te(e){return te="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},te(e)}function ne(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,n)}return t}function oe(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?ne(Object(t),!0).forEach((function(r){ye(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):ne(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}function le(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function ae(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function ie(e,r){return ie=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,r){return e.__proto__=r,e},ie(e,r)}function ue(e,r){if(r&&("object"===te(r)||"function"==typeof r))return r;if(void 0!==r)throw new TypeError("Derived constructors may only return object or undefined");return ce(e)}function ce(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function se(e){return se=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},se(e)}function ye(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function fe(e,r){(null==r||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}(0,f.Yq)("mergelyr");var pe=function(e){!function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(r&&r.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),r&&ie(e,r)}(i,e);var r,t,n,o,l=(n=i,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=se(n);if(o){var t=se(this).constructor;e=Reflect.construct(r,arguments,t)}else e=r.apply(this,arguments);return ue(this,e)});function i(){var e;le(this,i);for(var r=arguments.length,t=new Array(r),n=0;n<r;n++)t[n]=arguments[n];return ye(ce(e=l.call.apply(l,[this].concat(t))),"dialogStyle",{position:"fixed",top:"0px",left:"0px",width:"500px"}),ye(ce(e),"start",{x:.5*(window.innerWidth-600),y:.5*(window.innerHeight-100)}),ye(ce(e),"onClose",(function(){e.props.onClose(!1)})),ye(ce(e),"onChangeLayer1",(function(r){e.props.onChangeLayer1(r)})),ye(ce(e),"onChangeLayer2",(function(r){e.props.onChangeLayer2(r)})),ye(ce(e),"onDoMerge",(function(){e.props.onDoMerge(e.props.layersNode[e.props.layerIndex1],e.props.layersNode[e.props.layerIndex2])})),ye(ce(e),"onReset",(function(){e.props.onChangeLayer1(-1),e.props.onChangeLayer2(-1)})),e}return r=i,(t=[{key:"render",value:function(){return this.props.show?a().createElement(m.Z,{Dialog:!0,id:"measure-dialog",style:null==this?void 0:this.dialogStyle,start:null==this?void 0:this.start},a().createElement("div",{key:"header",role:"header"},a().createElement(I.Z,{msgId:"mergeLayerPlugin.title"}),a().createElement("button",{key:"close",onClick:this.onClose,className:"close"},a().createElement(g.Glyphicon,{glyph:"1-close"}))),a().createElement("div",{key:"body",role:"body"},a().createElement("p",null,a().createElement(I.Z,{msgId:"mergeLayerPlugin.layerLabel1"})),a().createElement(j,{responses:this.props.layersNode,index:this.props.layerIndex1,setIndex:this.onChangeLayer1}),a().createElement("br",null),a().createElement("p",null,a().createElement(I.Z,{msgId:"mergeLayerPlugin.layerLabel2"})),a().createElement(j,{responses:this.props.layersNode,index:this.props.layerIndex2,setIndex:this.onChangeLayer2}),a().createElement("br",null),a().createElement("div",{style:{display:"flex",flexDirection:"row",justifyContent:"right"}},this.props.loading?a().createElement("button",{key:"mergelayer-merge",className:"btn btn-outline-info",style:{minWidth:"100px"},disabled:!0},a().createElement(I.Z,{msgId:"mergeLayerPlugin.loading"})):a().createElement("button",{key:"mergelayer-merge",className:"btn btn-outline-info",style:{minWidth:"100px"},onClick:this.onDoMerge},a().createElement(I.Z,{msgId:"mergeLayerPlugin.button"})),a().createElement("button",{key:"clear-mergelayer",className:"btn btn-outline",style:{minWidth:"100px"},onClick:this.onReset},a().createElement(I.Z,{msgId:"mergeLayerPlugin.resetButton"}))),a().createElement("br",null),"succeed"===this.props.error?a().createElement("span",{style:{color:"green"}},a().createElement(I.Z,{msgId:"mergeLayerPlugin.successText"})):a().createElement("span",{style:{color:"red"}},this.props.error))):null}}])&&ae(r.prototype,t),Object.defineProperty(r,"prototype",{writable:!1}),i}(a().Component);ye(pe,"propTypes",{show:o().bool,layersNode:o().array,layersGroups:o().array,layerIndex1:o().number,layerIndex2:o().number,loading:o().bool,error:o().string,onDoMerge:o().func,onChangeLayer1:o().func,onChangeLayer2:o().func,onReset:o().func}),ye(pe,"defaultProps",{show:!1,layersNode:[],layersGroups:[],layerIndex1:-1,layerIndex2:-1,loading:!1,error:"",onDoMerge:function(){},onChangeLayer1:function(){},onChangeLayer2:function(){},onReset:function(){}});var de=(0,i.connect)((0,d.P1)([function(e){return{layerIndex1:e.mergelyr.layerIndex1,layerIndex2:e.mergelyr.layerIndex2,loading:e.mergelyr.loading,error:e.mergelyr.error,mergedLayer:e.mergelyr.mergedLayer}},function(e){return function(e){return y()(e,"controls.mergelyr.enabled")}(e)},S.Bt,S.l2],(function(e,r,t,n){return oe(oe({},e),{},{show:r,layersGroups:t,layersNode:(o=t,l=[],o.map((function(e){var r;l.push.apply(l,function(e){if(Array.isArray(e))return fe(e)}(r=e.nodes)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(r)||function(e,r){if(e){if("string"==typeof e)return fe(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?fe(e,r):void 0}}(r)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}())})),l),allLayers:n});var o,l})),{onClose:function(){return{type:D,control:"mergelyr",property:null,layerSelected1:{},layerSelected2:{},layerIndex1:-1,layerIndex2:-1,loading:!1,error:""}},onChangeLayer1:T,onChangeLayer2:k,onDoMerge:function(e,r){return{type:A,layerSelected1:e,layerSelected2:r}}},null,{pure:!1})(pe);const ge={MergeLayerPlugin:c()(de,{BurgerMenu:{name:"mergelyr",position:12,panel:!1,help:"help",tooltip:"tooltip",text:"Merge",icon:a().createElement(g.Glyphicon,{glyph:"plus"}),action:function(){return(0,p.Xg)("mergelyr","enabled",!0)}}}),reducers:{mergelyr:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:N,r=arguments.length>1?arguments[1]:void 0;switch(r.type){case P:return c()({},e,{layerIndex1:r.index1});case C:return c()({},e,{layerIndex2:r.index2});case R:return c()({},e,{loading:r.isLoading});case _:return c()({},e,{error:r.error});case D:return c()({},e,{layerSelected1:r.layerSelected1,layerSelected2:r.layerSelected2,layerIndex1:r.layerIndex1,layerIndex2:r.layerIndex1,loading:r.loading,error:r.error});default:return e}}},epics:{doMergeEpic:function(e,r){var t=r.getState,n=void 0===t?function(){}:t;return e.ofType(A).filter((function(){return(n().controls.mergelyr||{}).enabled||!1})).switchMap((function(e){var r=e.layerSelected1,t=e.layerSelected2;return W().Observable.from([re(r,t)])}))},mergeAsLayerEpic:function(e){return e.ofType(M).switchMap((function(e){var r=e.featureCollection;return W().Observable.of((0,H.A4)({type:"vector",id:U()(),name:"MergeLayer",hideLoading:!0,features:J(r.features),visibility:!0,title:"Merged_("+K+"&"+ee+")"}))}))}}}}}]);