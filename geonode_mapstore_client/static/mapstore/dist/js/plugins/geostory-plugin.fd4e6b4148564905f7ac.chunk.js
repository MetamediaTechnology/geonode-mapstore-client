(self.webpackChunkgeonode_mapstore_client=self.webpackChunkgeonode_mapstore_client||[]).push([[62933],{262770:(e,t,n)=>{"use strict";n.d(t,{Z:()=>w});var r=n(124852),o=n.n(r),i=n(675263),a=n.n(i),c=n(441609),l=n.n(c),s=n(281763),u=n.n(s),d=n(490079);function p(e){return p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},p(e)}function f(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function y(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function b(e,t){return b=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},b(e,t)}function m(e,t){if(t&&("object"===p(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return v(e)}function v(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function g(e){return g=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},g(e)}function h(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var O=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&b(e,t)}(c,e);var t,n,r,i,a=(r=c,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=g(r);if(i){var n=g(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return m(this,e)});function c(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,c),h(v(t=a.call(this,e)),"state",{containerWidth:0,legendContainerStyle:{overflowX:"auto"}}),h(v(t),"canShow",(function(e){return e.visibility||!t.props.showOnlyIfVisible})),h(v(t),"useLegendOptions",(function(){return!l()(t.props.node.legendOptions)&&u()(t.props.node.legendOptions.legendHeight)&&u()(t.props.node.legendOptions.legendWidth)})),h(v(t),"setOverflow",(function(){return t.useLegendOptions()&&t.props.node.legendOptions.legendWidth>t.state.containerWidth})),t.containerRef=o().createRef(),t}return t=c,n=[{key:"componentDidMount",value:function(){var e=this.containerRef.current&&this.containerRef.current.clientWidth;this.setState(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?f(Object(n),!0).forEach((function(t){h(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):f(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({containerWidth:e},this.state))}},{key:"render",value:function(){var e=this.props.node||{},t=this.canShow(e)&&"wms"===e.type&&"background"!==e.group,n=t&&this.useLegendOptions();return t?o().createElement("div",{style:this.setOverflow()?this.state.legendContainerStyle:this.props.legendContainerStyle,ref:this.containerRef},o().createElement(d.Z,{style:this.setOverflow()?{}:this.props.legendStyle,layer:e,currentZoomLvl:this.props.currentZoomLvl,scales:this.props.scales,legendHeight:n&&this.props.node.legendOptions&&this.props.node.legendOptions.legendHeight||this.props.legendHeight||void 0,legendWidth:n&&this.props.node.legendOptions&&this.props.node.legendOptions.legendWidth||this.props.legendWidth||void 0,legendOptions:this.props.WMSLegendOptions,scaleDependent:this.props.scaleDependent,language:this.props.language})):null}}],n&&y(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),c}(o().Component);h(O,"propTypes",{node:a().object,legendContainerStyle:a().object,legendStyle:a().object,showOnlyIfVisible:a().bool,currentZoomLvl:a().number,scales:a().array,WMSLegendOptions:a().string,scaleDependent:a().bool,language:a().string,legendWidth:a().number,legendHeight:a().number}),h(O,"defaultProps",{legendContainerStyle:{},showOnlyIfVisible:!1,scaleDependent:!0});const w=O},81593:(e,t,n)=>{"use strict";n.d(t,{Z:()=>p});var r=n(124852),o=n(945338);function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){c(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function c(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(e){return function(e){if(Array.isArray(e))return d(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||u(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function s(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i=[],a=!0,c=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);a=!0);}catch(e){c=!0,o=e}finally{try{a||null==n.return||n.return()}finally{if(c)throw o}}return i}}(e,t)||u(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function u(e,t){if(e){if("string"==typeof e)return d(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?d(e,t):void 0}}function d(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}const p=function(e){var t=e.direction,n=void 0===t?"horizontal":t,i=e.deltaScroll,u=e.width,d=e.height,p=e.transition,f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],y=(0,r.useState)(0),b=s(y,2),m=b[0],v=b[1],g=(0,r.useState)(0),h=s(g,2),O=h[0],w=h[1],E=(0,r.useRef)({x:0,y:0}),j=(0,r.useState)(!1),P=s(j,2),S=P[0],T=P[1],C=(0,r.useState)("start"),k=s(C,2),I=k[0],D=k[1],M=(0,r.useState)(),A=s(M,2),x=A[0],N=A[1],R=(0,r.useRef)(),L=(0,r.useRef)({});function Z(e,t){N("move:start");var r=R.current,o=r.parentNode,i=r.getBoundingClientRect(),a=o.getBoundingClientRect();if("horizontal"===n){var c=e+i.width;e<0&&c>a.width?(v(e),E.current.x=e,D("center")):e>=0?(v(0),E.current.x=0,D("start")):c<=a.width&&(v(a.width-i.width),E.current.x=a.width-i.width,D("end"))}if("vertical"===n){var l=t+i.height;t<0&&l>a.height?(w(t),E.current.y=t,D("center")):t>=0?(w(0),E.current.y=0,D("start")):l<=a.height&&(w(a.height-i.height),E.current.y=a.height-i.height,D("end"))}setTimeout((function(){N("move:end")}),p)}function W(e){Z(m+e,O+e)}function B(){var e=R.current,t=e.parentNode,r=e.getBoundingClientRect(),o=t.getBoundingClientRect();return!("horizontal"===n&&o.width>=r.width||"vertical"===n&&o.height>=r.height)}(0,r.useEffect)((function(){function e(e){e.preventDefault();var t=B();return T(B()),t?Z(E.current.x-(e.deltaY>0?i:-i),E.current.y-(e.deltaY>0?i:-i)):null}var t=B();T(t);var n=R.current.parentNode;return t&&Z(E.current.x,E.current.y),t&&n&&n.addEventListener&&n.addEventListener("wheel",e),function(){t&&n&&n.removeEventListener&&n.removeEventListener("wheel",e)}}),[u,d].concat(l(f)));var _=(0,o.QS)({onSwiping:function(e){e.event.stopPropagation();var t=B();return T(B()),t?Z(m-e.deltaX*e.velocity,O-e.deltaY*e.velocity):null},trackTouch:!0,trackMouse:!0});function V(e,t){L.current=a(a({},L.current),{},c({},e,t))}function H(e){var t=L.current[e];if(t){var r=R.current,o=(r&&r.parentNode).getBoundingClientRect(),i=t.getBoundingClientRect();if("horizontal"===n){var a=o.width,c=o.left,l=i.width,s=i.left,u=c+a,d=s+l;return c<=s&&u>=s||c<=d&&u>=d}}return!1}function F(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t.margin,o=void 0===r?0:r,i=L.current[e];if(i){var a=R.current,c=a&&a.parentNode,l=c.getBoundingClientRect(),s=i.getBoundingClientRect();if("horizontal"===n){var u=l.width,d=l.left,p=s.width,f=s.left,y=d+u,b=f+p,m=d<=f&&y>=b;if(!m){var v=a.getBoundingClientRect(),g=v.left;Z(-(f-g)+o,void 0)}}}}var z=S&&("end"===I||"center"===I),U=S&&("start"===I||"center"===I);return{status:x,canSwipe:S,isStartControlActive:z,isEndControlActive:U,positionLabel:I,coordinates:{x:m,y:O},containerPropsHandlers:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.style,n=void 0===t?{}:t;return a(a({},_),{},{style:a({position:"relative",overflow:"hidden",width:"100%",height:"100%"},n)})},contentPropsHandlers:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.style,r=void 0===t?{}:t;return{ref:R,style:a(a(a(a({position:"absolute",display:"flex"},p&&{transition:"transform ".concat(p,"ms ease 0s")}),{},{flexDirection:"horizontal"===n?"row":"column"},S&&"horizontal"===n&&{transform:"translateX(".concat(m,"px)")}),S&&"vertical"===n&&{transform:"translateY(".concat(O,"px)")}),r)}},itemPropsHandlers:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.id,n=e.onClick;return a({key:t,ref:function(e){return e&&V(t,e)}},n?{onClick:n,tabindex:H(t)?0:-1,onKeyDown:function(e){"Enter"===e.key&&n()}}:{tabindex:-1})},updateCoordinates:Z,moveItemInViewById:F,moveToDeltaSize:W}}},240986:(e,t,n)=>{"use strict";n.d(t,{Z:()=>d});var r=n(124852),o=n(675263),i=n.n(o),a=n(986267),c=n(752043);function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var s={openlayers:{fit:function(e){var t,n=e.map,r=e.geometry,o=e.padding,i=e.geometryProjection,l=e.fixedZoom,s=e.maxZoom,u=e.duration,d=n.getView(),p=d.getProjection().getCode();if(2===r.length){var f=(0,a.reproject)(r,i,p),y=f.x,b=f.y;t=new c.Z([y,b])}else t=(0,a.reprojectBbox)(r,i,p);var m=o||{},v=m.top,g=void 0===v?0:v,h=m.right,O=void 0===h?0:h,w=m.bottom,E=void 0===w?0:w,j=m.left,P=void 0===j?0:j;d.fit(t,{padding:[g,O,E,P],maxZoom:l?d.getZoom():s,duration:u})}},leaflet:{fit:function(e){var t,n,r,o=e.map,i=e.geometry,c=e.padding,s=e.geometryProjection,u=e.fixedZoom,d=e.maxZoom,p=e.duration,f=u?o.getZoom():d,y=c.top,b=void 0===y?0:y,m=c.right,v=void 0===m?0:m,g=c.bottom,h=void 0===g?0:g,O=c.left,w=void 0===O?0:O;if(2===i.length){var E=(0,a.reproject)(i,s,"EPSG:4326"),j=E.x,P=E.y;t=[[P,j],[P,j]]}else{var S=(n=(0,a.reprojectBbox)(i,s,"EPSG:4326"),r=4,function(e){if(Array.isArray(e))return e}(n)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i=[],a=!0,c=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);a=!0);}catch(e){c=!0,o=e}finally{try{a||null==n.return||n.return()}finally{if(c)throw o}}return i}}(n,r)||function(e,t){if(e){if("string"==typeof e)return l(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?l(e,t):void 0}}(n,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),T=S[0],C=S[1],k=S[2];t=[[C,T],[S[3],k]]}o.flyToBounds(t,{paddingTopLeft:[w,b],paddingBottomRight:[v,h],maxZoom:f,animate:!!p,duration:p/1e3})}}};function u(e){var t=e.map,n=e.mapType,o=e.active,i=e.geometry,a=e.geometryProjection,c=void 0===a?"EPSG:4326":a,l=e.padding,u=e.maxZoom,d=e.fixedZoom,p=e.duration,f=(0,r.useRef)();return f.current=function(){t&&s[n]&&s[n].fit({map:t,geometry:i,padding:l,geometryProjection:c,maxZoom:u,fixedZoom:d,duration:p})},(0,r.useEffect)((function(){o&&i&&f.current()}),[i,o]),null}u.propTypes={id:i().string,map:i().object,mapType:i().string,active:i().bool,geometry:i().array,geometryProjection:i().string,padding:i().object,maxZoom:i().number,fixedZoom:i().bool,duration:i().number},u.defaultProps={geometryProjection:"EPSG:4326",padding:{top:0,right:0,bottom:0,left:0}};const d=u},743837:(e,t,n)=>{"use strict";n.d(t,{Z:()=>b});var r=n(124852),o=n.n(r),i=n(675263),a=n.n(i),c=n(706909),l=["map","active","method","mapId","mapType","features","options","onChange"];function s(){return s=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},s.apply(this,arguments)}function u(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function d(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?u(Object(n),!0).forEach((function(t){p(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):u(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function p(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function f(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function y(e){var t,n,i=e.map,a=e.active,u=e.method,p=e.mapId,y=e.mapType,b=e.features,m=e.options,v=e.onChange,g=function(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}(e,l),h=(t=(0,r.useState)(null),n=2,function(e){if(Array.isArray(e))return e}(t)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i=[],a=!0,c=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);a=!0);}catch(e){c=!0,o=e}finally{try{a||null==n.return||n.return()}finally{if(c)throw o}}return i}}(t,n)||function(e,t){if(e){if("string"==typeof e)return f(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?f(e,t):void 0}}(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),O=h[0],w=h[1];return(0,r.useEffect)((function(){w(a?"drawOrEdit":"clean")}),[a]),"openlayers"!==y?null:o().createElement(c.Z,s({},g,{map:i,drawOwner:p,drawStatus:O,drawMethod:u,features:b,options:d({drawEnabled:a,addClickCallback:!0,editEnabled:!0,featureProjection:"EPSG:4326",geodesic:!1,stopAfterDrawing:!1,transformToFeatureCollection:!0,translateEnabled:!1,useSelectedStyle:!0},m),onDrawingFeatures:v.bind(null,p)}))}y.propTypes={active:a().bool,method:a().string,features:a().array,onChange:a().func,options:a().object},y.defaultProps={active:!1,method:"Point",features:[],onChange:function(){},options:{}};const b=y},487320:(e,t,n)=>{"use strict";n.d(t,{Z:()=>O});var r=n(124852),o=n.n(r),i=n(675263),a=n.n(i),c=n(107412),l=n(743129),s=n(757588),u=n(352595);function d(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var p=function(e){var t,n,i=e.text,a=e.placement,c=e.bsStyle,l=e.left,p=e.top,f=e.title,y=e.glyph,b=e.id,m=(0,r.useRef)(),v=(t=(0,r.useState)(!1),n=2,function(e){if(Array.isArray(e))return e}(t)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i=[],a=!0,c=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);a=!0);}catch(e){c=!0,o=e}finally{try{a||null==n.return||n.return()}finally{if(c)throw o}}return i}}(t,n)||function(e,t){if(e){if("string"==typeof e)return d(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?d(e,t):void 0}}(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),g=v[0],h=v[1];return o().createElement("span",{className:"mapstore-info-popover",onMouseLeave:function(){return h(!1)}},o().createElement(s.Glyphicon,{onMouseEnter:function(){h(!0)},ref:function(e){m.current=e},className:"text-".concat(c),glyph:y}),o().createElement(u.Z,{placement:a,show:g,target:function(){return m.current}},o().createElement(s.Popover,{id:b,placement:a,positionLeft:l,positionTop:p,title:f},o().createElement("div",{style:{display:"flex"}},i))))};p.propTypes={id:a().string,title:a().string,text:a().string,glyph:a().string,bsStyle:a().string,placement:a().string,left:a().number,top:a().number,trigger:a().oneOfType([a().array,a().bool])},p.defaultProps={id:"",title:"",text:"",placement:"right",left:200,top:50,glyph:"question-sign",bsStyle:"info"};const f=p;var y=n(615402);function b(){return b=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},b.apply(this,arguments)}function m(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function v(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?m(Object(n),!0).forEach((function(t){g(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):m(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function g(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function h(e){var t=e.id,n=e.label,r=e.infoFormat,i=e.availableInfoFormat,a=e.popoverMessage,c=e.disabled,u=e.onInfoFormatChange,d=e.selectProps,p=Object.keys(i).reduce((function(e,t){return Object.keys(e).map((function(t){return e[t]})).some((function(e){return e===i[t]}))?e:v(v({},e),{},g({},t,i[t]))}),{}),m=Object.keys(p).map((function(e){return{value:p[e],label:e}})),h=o().createElement(o().Fragment,null,"   ",a&&o().createElement(f,{text:o().createElement(y.Z,{msgId:a})}),o().createElement(l.ZP,b({},d,{id:t,value:r,clearable:!1,disabled:c,options:m,onChange:function(e){return u(null==e?void 0:e.value)}})));return n?o().createElement(s.FormGroup,{bsSize:"small"},o().createElement(s.ControlLabel,null,n),h):h}h.propTypes={id:a().string,label:a().oneOfType([a().func,a().string,a().object]),availableInfoFormat:a().object,infoFormat:a().string,popoverMessage:a().string,onInfoFormatChange:a().func,disabled:a().bool,selectProps:a().object},h.defaultProps={id:"mapstore-feature-format-selector",availableInfoFormat:(0,c.eq)(),infoFormat:(0,c.wR)(),popoverMessage:"",onInfoFormatChange:function(){},selectProps:{}};const O=h},352595:(e,t,n)=>{"use strict";n.d(t,{Z:()=>r});const r=(0,n(461365).Z)(n(757588).Overlay)},1036:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});var r=n(618446),o=n.n(r);const i=(0,n(867076).shouldUpdate)((function(e,t){return!o()(e.start,t.start)||e.disabled!==t.disabled}))(n(185552))},61018:(e,t,n)=>{"use strict";n.d(t,{Z:()=>p});var r=n(124852),o=n.n(r),i=n(807472),a=n(757588),c=["show","style","modal","draggable","closeGlyph","closable","onClose","title","header","footer","children"];function l(){return l=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},l.apply(this,arguments)}function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function u(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){d(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function d(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const p=function(e){var t=e.show,n=e.style,r=void 0===n?{}:n,s=e.modal,d=e.draggable,p=void 0!==d&&d,f=e.closeGlyph,y=void 0===f?"1-close":f,b=e.closable,m=void 0===b||b,v=e.onClose,g=void 0===v?function(){}:v,h=e.title,O=e.header,w=e.footer,E=e.children,j=function(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}(e,c);return t?o().createElement(i.Z,l({modal:s,onClickOut:m&&s?function(){return g()}:null,style:u(u({},r),{},{display:t?"block":"none"}),draggable:p},j),o().createElement("span",{role:"header"},h||O||o().createElement("span",null," "),m?o().createElement("button",{onClick:function(){return g()},className:"settings-panel-close close"},o().createElement(a.Glyphicon,{glyph:y})):null),o().createElement("span",{role:"body"},E),w?o().createElement("span",{role:"footer"},w):null):null}},5993:(e,t,n)=>{"use strict";n.d(t,{Z:()=>f});var r=n(675263),o=n.n(r),i=n(984596),a=n.n(i),c=n(867076),l=n(86638),s=["locale"];function u(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function d(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?u(Object(n),!0).forEach((function(t){p(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):u(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function p(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const f=function(e){return(0,c.compose)((0,c.getContext)({locale:o().string}),(0,c.mapProps)((function(t){var n=t.locale,r=function(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}(t,s);return d(d({},r),a()(e).reduce(function(e,t){return function(){var n=arguments.length>1?arguments[1]:void 0;return d(d({},arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}),{},p({},n,e[n]&&(0,l.MZ)(t,e[n])))}}(r,n),{}))})))}},979105:(e,t,n)=>{"use strict";n.d(t,{Z:()=>o});var r=n(867076);const o=function(e,t,n){return(0,r.branch)((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return!e[t]}),(0,r.withState)(e,t,n))}},75927:(e,t,n)=>{"use strict";n.d(t,{Z:()=>b});var r=n(513218),o=n.n(r),i=n(124852),a=n.n(i),c=n(757588),l=n(805346),s=n(815135),u=["settings","element","tabs","activeTab","width","groups","isLocalizedLayerStylesEnabled","setActiveTab","onUpdateParams","onRetrieveLayerData","realtimeUpdate"];function d(){return d=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},d.apply(this,arguments)}function p(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function f(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var y=(0,s.Z)(c.NavItem);const b=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.settings,n=e.element,r=void 0===n?{}:n,i=e.tabs,s=void 0===i?[]:i,b=e.activeTab,m=e.width,v=e.groups,g=e.isLocalizedLayerStylesEnabled,h=e.setActiveTab,O=void 0===h?function(){}:h,w=e.onUpdateParams,E=void 0===w?function(){}:w,j=e.onRetrieveLayerData,P=void 0===j?function(){}:j,S=e.realtimeUpdate,T=f(e,u);return a().createElement(c.Row,{key:"ms-toc-settings-navbar",className:"ms-row-tab"},a().createElement(c.Col,{xs:12},a().createElement(c.Nav,{bsStyle:"tabs",activeKey:b,justified:!0},s.map((function(e){return a().createElement(y,{key:"ms-tab-settings-"+e.id,tooltip:a().createElement(l.Z,{msgId:e.tooltipId}),eventKey:e.id,onClick:function(){return O(e.id)}},a().createElement(c.Glyphicon,{glyph:e.glyph}))})))),a().createElement(c.Col,{xs:12},s.filter((function(e){return e.id&&e.id===b})).filter((function(e){return e.Component})).map((function(e){return a().createElement(e.Component,d({},T,{key:"ms-tab-settings-body-"+e.id,containerWidth:m,element:r,groups:v,nodeType:t.nodeType,settings:t,retrieveLayerData:P,isLocalizedLayerStylesEnabled:g,onChange:function(e,t){return o()(e)?E(e,S):E(p({},e,t),S)}}))}))))}},616701:(e,t,n)=>{"use strict";n.d(t,{Z:()=>O});var r=n(124852),o=n.n(r),i=n(867076),a=n(581859),c=n(590690),l=n(229423),s=n(221338),u=n(91175),d=n.n(u);function p(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function f(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?p(Object(n),!0).forEach((function(t){y(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):p(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function y(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var b=function e(t,n){return t.reduce((function(t,r){var o=f({},r);return o.nodes&&(o=f(f({},o),{},{nodes:e(o.nodes,n)})),n.forEach((function(e){o.nodes&&e.func(o)?o=f(f({},o),e.options):o.nodes&&(o=f({},o))})),t.push(o),t}),[])},m=function(e){var t=e.nodes,n=e.filterText;return e.currentLocale,b(t,[{options:{showComponent:!0},func:function(){return!n}},{options:{loadingError:!0},func:function(e){return d()(e.nodes.filter((function(e){return e.loadingError&&"Warning"!==e.loadingError})))}},{options:{expanded:!0,showComponent:!0},func:function(e){return n&&d()(e.nodes.filter((function(e){return!0})))}}])};const v=(0,i.withProps)((function(e){return{nodes:m(e)}}));var g=n(803307),h=n(117802);const O=(0,i.compose)(h.Z,v,g.Z)((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.changeLayerPropertyByGroup,n=void 0===t?function(){}:t,r=e.changeLayerProperty,i=void 0===r?function(){}:r,u=e.changeGroupProperty,d=void 0===u?function(){}:u,p=e.onSort,f=e.onSelect,y=e.selectedNodes,b=e.nodes,m=void 0===b?[]:b;return o().createElement(s.Z,{onSort:p,selectedNodes:y,onSelect:f,nodes:m},o().createElement(l.Z,{groupElement:o().createElement(a.Z,{onSort:p,selectedNodes:y,onSelect:f,propertiesChangeHandler:function(e,t){return Object.keys(t).map((function(r){return n(e,r,t[r])}))},onToggle:function(e,t){return d(e,"expanded",!t)},groupVisibilityCheckbox:!0}),layerElement:o().createElement(c.Z,{selectedNodes:y,onSelect:f,titleTooltip:!0,propertiesChangeHandler:function(e,t){return Object.keys(t).map((function(n){return i(e,n,t[n])}))},onUpdateNode:function(e,t,n){return Object.keys(n).map((function(t){return i(e,t,n[t])}))},onToggle:function(e,t){return i(e,"expanded",!t)}})}))}))},803307:(e,t,n)=>{"use strict";n.d(t,{Z:()=>s});var r=n(984596),o=n.n(r),i=n(630998),a=n.n(i),c=n(867076),l=n(624262);const s=(0,c.withHandlers)({changeLayerProperty:function(e){var t=e.onChange,n=void 0===t?function(){}:t,r=e.map,o=void 0===r?{}:r;return function(e,t,r){var i=a()(o.layers||[],{id:e});n("map.layers[".concat(i,"].").concat(t),r)}},changeLayerPropertyByGroup:function(e){var t=e.onChange,n=void 0===t?function(){}:t,r=e.map,o=void 0===r?{}:r;return function(e,t,r){return o.layers.filter((0,l.CK)(e)).map((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.id;return a()(o.layers||[],{id:t})})).filter((function(e){return e>=0})).map((function(e){return n("map.layers[".concat(e,"].").concat(t),r)}))}},changeGroupProperty:function(e){var t=e.onChange,n=void 0===t?function(){}:t,r=e.map,i=void 0===r?[]:r;return function(e,t,r){var c,l=i.groups?o()(i.groups):[],s=a()(l,(function(t){return e===t.id})),u=-1===s?l.length:s;"expanded"!==t||null!=l&&null!==(c=l[u])&&void 0!==c&&c.id||n("map.groups[".concat(u,"].id"),e),n("map.groups[".concat(u,"].").concat(t),r)}},updateMapEntries:function(e){var t=e.onChange,n=void 0===t?function(){}:t;return function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object.keys(e).map((function(t){return n("map[".concat(t,"]"),e[t])}))}}})},648860:(e,t,n)=>{"use strict";n.d(t,{Z:()=>s});var r=n(630998),o=n.n(r),i=n(867076);function a(e){return function(e){if(Array.isArray(e))return c(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return c(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?c(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function c(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var l=function(e,t){return(t.layers||[]).filter((function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.group,r=void 0===n?"Default":n;return r===e})).map((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.id;return t}))};const s=(0,i.compose)((0,i.withStateHandlers)((function(){return{selectedLayers:[],selectedGroups:[]}}),{onNodeSelect:function(e,t){var n=e.selectedLayers,r=void 0===n?[]:n,i=e.selectedGroups,c=void 0===i?[]:i,s=t.map,u=void 0===s?{}:s;return function(e,t,n){return{selectedLayers:"group"===t?o()(c,(function(t){return t===e}))>=0?r.filter((function(t){return o()(l(e,u),(function(e){return e===t}))<0})):n?[].concat(a(r),a(l(e,u))):a(l(e,u)):o()(r,(function(t){return t===e}))>=0?r.filter((function(t){return t!==e})):n?[].concat(a(r),[e]):[e],selectedGroups:"group"===t?o()(c,(function(t){return t===e}))>=0?c.filter((function(t){return t!==e})):n?[].concat(a(c),[e]):[e]:n?c:[]}}}}),(0,i.withProps)((function(e){var t=e.selectedLayers,n=e.selectedGroups;return{selectedNodes:[].concat(a(t),a(n))}})))},117802:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});var r=n(867076),o=n(624262);const i=(0,r.withProps)((function(e){var t,n,r,i=e.map;return{nodes:(t=(0,o.DN)(i),n=t.layers,r=void 0===n?{}:n,(0,o.C1)(r.flat||[],r.groups||[]).groups)}}))},651768:(e,t,n)=>{"use strict";n.d(t,{Z:()=>Y});var r=n(227361),o=n.n(r),i=n(867076),a=n(624262),c=n(979105),l=n(487427),s=n(518842),u=n(363209),d=n(630998),p=n.n(d),f=n(675263),y=n.n(f),b=n(124852),m=n.n(b),v=n(757588),g=n(743129),h=n(282467),O=n(805346);function w(e){return w="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},w(e)}function E(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function j(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function P(e,t){return P=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},P(e,t)}function S(e,t){if(t&&("object"===w(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return T(e)}function T(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function C(e){return C=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},C(e)}function k(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var I=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&P(e,t)}(a,e);var t,n,r,o,i=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=C(r);if(o){var n=C(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return S(this,e)});function a(){var e;E(this,a);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return k(T(e=i.call.apply(i,[this].concat(n))),"renderLegend",(function(){return null})),k(T(e),"renderItemLabel",(function(e){return m().createElement("div",null,m().createElement("div",{key:"item-title"},e.title||e.name),m().createElement("div",null,m().createElement("small",{className:"text-muted",key:"item-key-description"},e.name)))})),k(T(e),"renderError",(function(){return e.props.element&&e.props.element.capabilities&&e.props.element&&e.props.element.capabilities.error?m().createElement(v.Alert,{bsStyle:"danger"},m().createElement(O.Z,{msgId:"layerProperties.styleListLoadError"})):null})),k(T(e),"updateEntry",(function(t,n){var r=n.target.value;e.props.onChange(t,r)})),e}return t=a,(n=[{key:"render",value:function(){var e=this,t=[{label:"Default Style",value:""}].concat((this.props.element.availableStyles||[]).map((function(t){return{label:e.renderItemLabel(t),value:t.name}})));return(this.props.element.style&&this.props.element.availableStyles&&p()(this.props.element.availableStyles,(function(t){return t.name===e.props.element.style})))>=0||!this.props.element.style||t.push({label:this.props.element.style,value:this.props.element.style}),m().createElement(v.Grid,{fluid:!0,style:{paddingTop:15,paddingBottom:15}},m().createElement("form",{ref:"style"},m().createElement(g.ZP.Creatable,{key:"styles-dropdown",options:t,isLoading:this.props.element&&this.props.element.capabilitiesLoading,value:this.props.element.style||"",onOpen:function(){!e.props.element||e.props.element.capabilities&&e.props.element.availableStyles||e.props.retrieveLayerData(e.props.element)},promptTextCreator:function(e){return m().createElement(O.Z,{msgId:"layerProperties.styleCustom",msgParams:{value:e}})},onChange:function(t){e.updateEntry("style",{target:{value:t&&t.value||""}})}}),m().createElement("br",null),this.renderLegend(),this.renderError(),m().createElement(h.Z,{bsStyle:"primary",style:{float:"right"},onClick:function(){return e.props.retrieveLayerData(e.props.element)}},m().createElement(v.Glyphicon,{glyph:"refresh"})," ",m().createElement(O.Z,{msgId:"layerProperties.stylesRefreshList"})),m().createElement("br",null)))}}])&&j(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),a}(m().Component);k(I,"propTypes",{retrieveLayerData:y().func,onChange:y().func,element:y().object,groups:y().array}),k(I,"defaultProps",{element:{},retrieveLayerData:function(){},onChange:function(){}});const D=I;var M=n(803307),A=n(117802),x=n(49977),N=n.n(x),R=n(680833);function L(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Z(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?L(Object(n),!0).forEach((function(t){W(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):L(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function W(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const B=(0,i.mapPropsStream)((function(e){var t=(0,i.createEventHandler)(),n=t.stream,r=t.handler;return e.pluck("element").distinctUntilChanged((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e.id===t.id})).switchMap((function(){return n.switchMap((function(e){return(0,R.kB)(e).map((function(e){return{capabilities:e,capabilitiesLoading:null,description:e._abstract,boundingBox:e.latLonBoundingBox,availableStyles:e.style&&(Array.isArray(e.style)?e.style:[e.style])}})).startWith({capabilitiesLoading:!0})})).catch((function(e){return N().Observable.of({capabilitiesLoading:null,capabilities:{error:"error getting capabilities",details:e},description:null})}))})).startWith({}).combineLatest(e,(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Z(Z({},t),{},{retrieveLayerData:r,element:Z(Z({},t.element),e)})}))}));var _=n(666379),V=n.n(_),H=void 0;function F(e){return F="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},F(e)}var z=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1?arguments[1]:void 0,r=arguments.length>2?arguments[2]:void 0;for(var o in t)null!==t[o]&&"object"===F(t[o])&&(V()(t[o],n)&&r.apply(H,[t[o]]),e(t[o],n,r))};const U=(0,i.withProps)((function(e){var t=e.nodes,n=void 0===t?{}:t,r=e.editNode,o={};return r&&z(n,{id:r},(function(e){o=e})),{selectedNode:o}}));function G(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function q(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?G(Object(n),!0).forEach((function(t){K(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):G(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function K(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var $=B(D),Q=(0,i.withProps)((function(e){return{tabs:e.tabs||[{id:"general",titleId:"layerProperties.general",tooltipId:"layerProperties.general",glyph:"wrench",visible:!0,Component:u.Z},{id:"display",titleId:"layerProperties.display",tooltipId:"layerProperties.display",glyph:"eye-open",visible:e.settings&&"layers"===e.settings.nodeType,Component:s.Z},{id:"style",titleId:"layerProperties.style",tooltipId:"layerProperties.style",glyph:"dropper",visible:e.settings&&"layers"===e.settings.nodeType&&e.element&&"wms"===e.element.type,Component:$}]}}));const Y=(0,i.compose)(A.Z,U,(0,i.withState)("settings","onUpdateSettings",{}),(0,i.withProps)((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.map,n=void 0===t?{}:t,r=e.selectedNode,i=e.settings,c=void 0===i?{}:i;return{element:r,settings:q(q({},c),{},{nodeType:r&&r.nodes?"groups":"layers",options:{opacity:c.opacity>=0?c.opacity:r.opacity>=0?r.opacity:1}}),groups:o()((0,a.DN)(n),"layers.groups")}})),(0,i.compose)(M.Z,(0,i.withHandlers)({onUpdateNode:function(e){var t=e.changeLayerProperty,n=void 0===t?function(){}:t,r=e.changeGroupProperty,o=void 0===r?function(){}:r,i=e.editNode;return function(e,t,r){"layers"===t&&Object.keys(r).map((function(e){return n(i,e,r[e])})),"groups"===t&&Object.keys(r).map((function(e){return o(i,e,r[e])}))}}}),(0,i.withHandlers)({onUpdateParams:function(e){var t=e.settings,n=void 0===t?{}:t,r=e.onUpdateNode,o=void 0===r?function(){}:r;return function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];t&&o(n.node,n.nodeType,q(q({},n.props),e))}}})),l.kZ,(0,c.Z)("activeTab","setActiveTab","general"),Q)},202576:(e,t,n)=>{"use strict";n.d(t,{Z:()=>O});var r=n(124852),o=n.n(r),i=n(180307),a=n.n(i),c=n(675263),l=n.n(c),s=n(757588),u=n(352595),d=n(950966);function p(e){return p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},p(e)}function f(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function y(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function b(e,t){return b=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},b(e,t)}function m(e,t){if(t&&("object"===p(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function v(e){return v=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},v(e)}function g(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var h=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&b(e,t)}(l,e);var t,n,r,i,c=(r=l,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=v(r);if(i){var n=v(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return m(this,e)});function l(){return f(this,l),c.apply(this,arguments)}return t=l,(n=[{key:"renderPopover",value:function(){return o().createElement(s.Popover,{id:this.props.id,placement:this.props.placement,positionLeft:this.props.left,positionTop:this.props.top,title:this.props.title},this.props.text)}},{key:"renderContent",value:function(){var e=this;return o().createElement(s.Glyphicon,{ref:function(t){e.target=t},className:"text-".concat(this.props.bsStyle),glyph:this.props.glyph})}},{key:"render",value:function(){var e=this,t=!0===this.props.trigger?["hover","focus"]:this.props.trigger;return o().createElement("span",{className:"mapstore-info-popover"},this.props.trigger?o().createElement(d.Z,{trigger:t,placement:this.props.placement,overlay:this.renderPopover()},this.renderContent()):[this.renderContent(),o().createElement(u.Z,{placement:this.props.placement,show:!0,target:function(){return a().findDOMNode(e.target)}},this.renderPopover())])}}])&&y(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),l}(o().Component);g(h,"propTypes",{id:l().string,title:l().string,text:l().string,glyph:l().string,bsStyle:l().string,placement:l().string,left:l().number,top:l().number,trigger:l().oneOfType([l().array,l().bool])}),g(h,"defaultProps",{id:"",title:"",text:"",placement:"right",left:200,top:50,glyph:"question-sign",bsStyle:"info",trigger:["hover","focus"]});const O=h},589919:(e,t,n)=>{"use strict";n.d(t,{hP:()=>u});var r=n(984596),o=n.n(r),i=n(49977),a=n.n(i);function c(e){return function(e){if(Array.isArray(e))return l(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return l(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?l(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var s=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return e.startWith.apply(e,c(t))},u=function(e,t,n){return function(r){return(n?s(r,o()(e)).catch(n):s(r,o()(e))).concat(a().Observable.from(o()(t)))}}},95163:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>Oc});var r={};n.r(r),n.d(r,{cleanUpEmptyStoryContainers:()=>me,closeShareOnGeostoryChangeMode:()=>we,editMediaForBackgroundEpic:()=>fe,editWebPageComponent:()=>ue,handlePendingGeoStoryChanges:()=>Ee,hideCarouselItemsOnUpdateCurrentPage:()=>he,inlineEditorEditMap:()=>Oe,loadGeostoryEpic:()=>ye,loadStoryOnHistoryPop:()=>Se,openMediaEditorForNewMedia:()=>ce,openWebPageComponentCreator:()=>se,reloadGeoStoryOnLoginLogout:()=>be,saveGeoStoryResource:()=>de,scrollOnLoad:()=>Pe,scrollSideBar:()=>Te,scrollToContentEpic:()=>pe,setFocusOnMapEditing:()=>ge,sortContentEpic:()=>ve,urlUpdateOnScroll:()=>je});var o=n(124852),i=n.n(o),a=n(171703),c=n(22222),l=n(375933),s=n.n(l),u=n(322843),d=n(192579),p=n(86638),f=n(531398),y=n(134990),b=n(93848),m=n(49977),v=n(91175),g=n.n(v),h=n(807654),O=n.n(h),w=n(747037),E=n.n(w),j=n(414293),P=n.n(j),S=n(595825),T=n.n(S),C=n(158748),k=n.n(C),I=n(227361),D=n.n(I),M=n(701469),A=n.n(M),x=n(441609),N=n.n(x),R=n(275982),L=n(423570),Z=n.n(L),W=n(375875),B=n.n(W),_=n(291312),V=n(782904),H=n(197395),F=n(263516),z=n(274621),U=n(866113),G=n(107501),q=n(589919),K=n(727693),$=n(282385),Q=["status","statusText","data","message"],Y=["data","isStatic"];function X(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i=[],a=!0,c=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);a=!0);}catch(e){c=!0,o=e}finally{try{a||null==n.return||n.return()}finally{if(c)throw o}}return i}}(e,t)||oe(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function J(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ee(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?J(Object(n),!0).forEach((function(t){te(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):J(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function te(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ne(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}function re(e){return function(e){if(Array.isArray(e))return ie(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||oe(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function oe(e,t){if(e){if("string"==typeof e)return ie(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ie(e,t):void 0}}function ie(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var ae=function(e,t,n){return function(r){return r.ofType(b.AQ).switchMap((function(r){var o=r.resource,i=void 0===o?{}:o,a=[],c=e.getState(),l=(0,G.hb)(c),s=(0,G.IQ)(c),u=g()((0,U.jq)(c).filter((function(e){return e.data&&(s!==K.rR.GEOSTORY&&e.data.id||e.id)===i.id}))),p=i.id;u?p=u.id:N()(i)?a=[].concat(re(a),[(0,y.Od)("".concat(t)),(0,b.Cp)()]):(p=i.id||Z()(),a=[].concat(re(a),[(0,y.rp)(p,l,i.data?i.data:i)]));var f=l===d.Tr.MAP?{resourceId:p,type:l,map:void 0}:{resourceId:p,type:l},v=[(0,y.Vx)("".concat(t),f,"merge")];return n===d.ID.CAROUSEL&&v.push((0,y.Vx)("".concat(t,".map"),{mapInfoControl:!0},"merge")),a=[].concat(re(a),v,[(0,b.Cp)()]),m.Observable.from(a)}))}},ce=function(e,t){return e.ofType(y.D7).filter((function(e){var t=e.element,n=void 0===t?{}:t;return n.type===d.bT.MEDIA||(0,d.lt)(n)})).switchMap((function(n){var r=n.path,o=n.element,i="";(0,d.lt)(o)&&"sections"===r&&(i=".contents[0].contents[0]");var a="".concat(r,'[{"id":"').concat(o.id,'"}]').concat(i),c=(0,U.X6)(t.getState());return m.Observable.of((0,b.$Z)("geostory",c)).merge(e.let(ae(t,a)),e.ofType(b.B8).switchMap((function(){return m.Observable.of((0,y.Od)(a))})).takeUntil(e.ofType(y.wb))).takeUntil(e.ofType(b.wd))}))},le=function(e){return function(t){return t.ofType(y.Hb).switchMap((function(t){var n=t.src;return m.Observable.of((0,y.Vx)("".concat(e),{src:n,editURL:!1},"merge"))}))}},se=function(e){return e.ofType(y.D7).filter((function(e){var t=e.element,n=void 0===t?{}:t;return n.type===d.bT.WEBPAGE&&!1!==n.editURL||(0,d.NC)(n)})).switchMap((function(t){var n=t.path,r=t.element,o="";(0,d.NC)(r)&&"sections"===n&&(o=".contents[0].contents[0]");var i="".concat(n,'[{"id":"').concat(r.id,'"}]').concat(o);return m.Observable.of((0,y.Vx)(i,{editURL:!0},"merge")).merge(e.let(le(i))).takeUntil(e.ofType(y.cc))}))},ue=function(e){return e.ofType(y.cc).switchMap((function(t){var n=t.path;return m.Observable.of((0,y.Vx)(n,{editURL:!0},"merge")).merge(e.let(le(n))).takeUntil(e.ofType(y.D7))}))},de=function(e){return e.ofType(y.LE).exhaustMap((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.resource,n=e.delay,r=void 0===n?1e3:n;return(t.id?(0,_.id)(t):(0,_.SN)(t)).switchMap((function(e){return m.Observable.of((0,y.GD)(e),(0,y.g5)(d.ZX.SHOW_SAVE,!1),t.id?(0,y.wJ)(e):(0,R.VF)("/geostory/".concat(e))).merge(m.Observable.of((0,H.$Z)({id:"STORY_SAVE_SUCCESS",title:"saveDialog.saveSuccessTitle",message:"saveDialog.saveSuccessMessage"})).delay(t.id?0:r))})).let((0,q.hP)((0,y.YP)(!0,"loading"),(0,y.YP)(!1,"loading"))).catch((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.status,n=e.statusText,r=e.data,o=e.message,i=ne(e,Q);return m.Observable.of((0,y.y6)(t?{status:t,statusText:n,data:r}:o||i),(0,y.YP)(!1,"loading"))}))}))},pe=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.getState,r=void 0===n?function(){}:n;return e.ofType(y.D7).switchMap((function(e){var t=e.path,n=e.element;return m.Observable.of(n).switchMap((function(){if(document.getElementById(n.id)){var e=(0,d.u0)(t).sectionId,o=(0,U.I0)(e)(r())?e:n.id;return(0,d.M1)(o,{behavior:"auto",block:"center"}),m.Observable.empty()}throw new Error("Item not mounted yet")})).retryWhen((function(e){return e.delay(200).take(10)}))}))},fe=function(e,t){return e.ofType(b.wd).switchMap((function(n){var r=n.path,o=n.owner,i=n.sectionType,a=(0,U.vv)(r)(t.getState()),c=(0,U.Tr)(a)(t.getState());return m.Observable.of((0,G.hb)(t.getState())).filter((function(e){return c&&c.type!==e})).map((function(){return(0,b.y5)(c.type)})).merge(m.Observable.of((0,b.$Z)(o,(0,U.X6)(t.getState())),(0,b.Gh)(a),(0,b.Tk)(i===d.ID.CAROUSEL?["image","video"]:[])).merge(e.let(ae(t,r,i)).takeUntil(e.ofType(b.B8,y.D7))))}))},ye=function(e,t){var n=t.getState,r=void 0===n?function(){}:n;return e.ofType(y.XH).switchMap((function(e){var t=e.id;return m.Observable.defer((function(){return t&&O()(parseInt(t,10))?B().get("configs/".concat(t,".json")).then((function(e){var t=e.data,n=t.sections,r=A()(n)&&n.map((function(e){return ee(ee({},e),{},{id:Z()()})}));return{data:r.length?ee(ee({},t),{},{sections:r}):t,isStatic:!0,canEdit:!0}})):(0,_.RX)(t)})).do((function(e){if(!e.data)throw Error("Wrong data format");return!0})).switchMap((function(e){var n=e.data,o=e.isStatic,i=void 0!==o&&o,a=ne(e,Y),c=r(),l=(0,z.qg)(c),s=(0,z.jl)(c),u=E()(n)?JSON.parse(n):n;if(!s&&O()(parseInt(t,10)))return m.Observable.of((0,y.Ct)({status:403}));var p=(0,U.eK)(c)===d.nl.EDIT;return m.Observable.from([].concat(re(i||p?[(0,y.D_)(a&&a.canEdit||l)]:[]),[(0,y.OS)(t),(0,y.K0)(u),(0,y.DF)(a)]))})).let((0,q.hP)((0,y.YP)(!0,"loading"),(0,y.YP)(!1,"loading"),(function(e){var t=(0,d.of)(),n=t+".errors.loading.unknownError";return 403===e.status?(n=t+".errors.loading.pleaseLogin",((0,z.jl)(r())||(0,U.JM)(r()))&&(n=t+".errors.loading.geostoryNotAccessible")):404===e.status?n=t+".errors.loading.geostoryDoesNotExist":P()(e.status)&&(n=e.message),m.Observable.of((0,H.vU)({title:t+".errors.loading.title",message:n}),(0,y.K0)({}),(0,y.Ct)(ee(ee({},e),{},{messageId:n})))}))).startWith((0,y.K0)({}))}))},be=function(e){return e.ofType(y.XH).switchMap((function(t){var n=t.id;return e.ofType(F.XP,F.Nv).switchMap((function(){return m.Observable.of((0,y.wJ)(n)).delay(500)})).takeUntil(e.ofType(R.nk))}))},me=function(e,t){var n=t.getState,r=void 0===n?function(){}:n;return e.ofType(y.Dq).switchMap((function(e){var t=e.path,n=(0,d.Ll)(t,(0,U.Kg)(r())),o=T()(n,"contents");if(o>0){var i=n.splice(0,o),a=(0,U.$F)(i.join("."))(r());if(a&&a.contents&&0===a.contents.length)return m.Observable.of((0,y.Od)(i.join(".")))}return m.Observable.empty()}))},ve=function(e,t){var n=t.getState,r=void 0===n?function(){}:n;return e.ofType(y.tP).switchMap((function(e){var t=e.source,n=e.target,o=e.position,i=r(),a=(0,U.$F)(t)(i);return m.Observable.from([(0,y.Od)(t),(0,y.IH)(n,o,a)])}))},ge=function(e,t){var n=t.getState,r=void 0===n?function(){}:n;return e.ofType(y.wb).filter((function(e){var t=e.path;return(void 0===t?"":t).endsWith("editMap")})).switchMap((function(e){var t=e.path,n=e.element,o=(0,d.ln)(t,(0,U.Kg)(r())),i=o.flatPath,a=o.path,c=1===i.length,l=c?i[0]:i.pop(),s=c?i[0]:i.shift(),u="background"===a[a.length-2],p=u&&"#".concat(s.id," .ms-section-background-container")||"#".concat(l.id);return(0,d.M1)(l.id),m.Observable.from([(0,y.$A)(n,l,p,u,t.replace(".editMap",""))])}))},he=function(e,t){var n=t.getState;return e.ofType(y.wb).filter((function(e){var t=e.path,n=e.element;return t&&t.endsWith("carouselToggle")&&n})).switchMap((function(e){var t=e.path,r=(0,d.u0)(t)||{},o=r.sectionId,i=r.contentId,a=(0,U.eB)(o)(n())||[];return i&&!N()(a)?m.Observable.from([(0,y.fD)(o,i)]).concat(m.Observable.of((0,y.Vx)(t,!1))):m.Observable.empty()}))},Oe=function(e,t){var n=t.getState;return e.ofType($.nr).filter((function(e){var t=e.owner,n=e.map;return"inlineEditor"===t&&!!n})).switchMap((function(){return e.ofType($.LE).switchMap((function(t){var r=t.map,o=(0,U.FW)(n()).path;return m.Observable.of((0,y.Vx)("".concat(o,".map"),r,"merge"),(0,y.Vx)("".concat(o,".editMap"),!1),(0,$.Cp)()).takeUntil(e.ofType($.B8))}))}))},we=function(e){return e.ofType(y.vb).switchMap((function(){return m.Observable.of((0,V.Xg)("share","enabled",!1))}))},Ee=function(e){return m.Observable.merge(e.ofType(y.XH).switchMap((function(){return e.ofType(y.Zf)}))).switchMap((function(){return e.ofType(y.D7,y.wb,y.Dq,y.mN,y.QK,y.km).take(1).switchMap((function(){return m.Observable.of((0,y.c0)(!0)).concat(e.ofType(y.si,R.nk,F.Nv).take(1).switchMap((function(){return m.Observable.of((0,y.c0)(!1))})))}))}))},je=function(e,t){var n=t.getState;return e.ofType(y.un).let(function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(e){return e};return function(r){return r.withLatestFrom(e.startWith(t)).filter((function(e){var t=X(e,2)[1];return n(t)})).map((function(e){return X(e,1)[0]}))}}(e.ofType(y.Gx).map((function(e){return!e.status})).startWith(!0))).debounceTime(50).switchMap((function(e){var t=e.sectionId,r=e.columnId;if("edit"!==(0,U.eK)(n())&&(r||t)&&(0,U.bU)(n())){var o,i,a=D()(n(),"geostory.resource.id"),c=(0,d.NP)(window.location.href,null===(o=window)||void 0===o||null===(i=o.location)||void 0===i?void 0:i.hash,a,t,r);c&&history.pushState(null,"",c)}return m.Observable.empty()}))},Pe=function(e){return e.ofType(y.ij).switchMap((function(e){var t,n,r,o=e.delay,i=void 0===o?2e3:o,a=null===(t=window)||void 0===t||null===(n=t.location)||void 0===n||null===(r=n.hash)||void 0===r?void 0:r.split("/");return m.Observable.of(a).do((function(){var e,t,n;null!==(e=window)&&void 0!==e&&null!==(t=e.location)&&void 0!==t&&null!==(n=t.hash)&&void 0!==n&&n.includes("shared")?(0,d.M1)(a[7]||a[5],{block:"start",behavior:"auto"}):a.length>5?(0,d.M1)(a[6],{block:"start",behavior:"auto"}):5===a.length&&(0,d.M1)(a[4],{block:"start",behavior:"auto"})})).ignoreElements().startWith((0,y.WE)(!0)).concat(m.Observable.of((0,y.WE)(!1)).delay(i))}))},Se=function(e){return e.ofType(R.nk).switchMap((function(e){var t,n=e.payload;if((null==n||null===(t=n.location)||void 0===t?void 0:t.pathname.includes("/geostory/"))&&"POP"===n.action&&!n.isFirstRendering){var r,o=k()(null==n||null===(r=n.location)||void 0===r?void 0:r.pathname);return o.find((function(e){return"shared"===e}))?m.Observable.of((0,y.wJ)(o[2])).delay(500):m.Observable.of((0,y.wJ)(o[1])).delay(500)}return m.Observable.empty()}))},Te=function(e,t){var n=t.getState;return e.ofType(y.un).filter((function(e){var t=e.columnId,r=e.sectionId;return!("edit"!==(0,U.eK)(n())||!t&&!r)})).debounceTime(50).switchMap((function(){return m.Observable.of(Array.from(document.querySelectorAll(".ms-geostory-builder .mapstore-side-card.ms-highlight")).pop()).filter((function(e){return!!e})).withLatestFrom(m.Observable.of(document.querySelector(".ms-geostory-builder .ms2-border-layout-body")).filter((function(e){return!!e}))).map((function(e){var t=X(e,2),n=t[0],r=t[1];return function(){var e=n.getBoundingClientRect(),t=e.top,o=e.bottom,i=r.getBoundingClientRect(),a=i.top,c=i.bottom;t<a?r.scrollBy({top:t-a-10,behavior:"smooth"}):o>c&&r.scrollBy({top:o-c+10,behavior:"smooth"})}})).do((function(e){return window.requestAnimationFrame(e)})).ignoreElements()}))},Ce=n(308316),ke=n(166190),Ie=n(965539),De=n(496259),Me=n(867076),Ae=n(828878);function xe(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Ne(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?xe(Object(n),!0).forEach((function(t){Re(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):xe(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Re(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Le(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}(0,Me.setObservableConfig)(Ae.Z);var Ze=(0,Me.compose)((0,Me.mapPropsStream)((function(e){var t=(0,Me.createEventHandler)(),n=t.handler,r=t.stream,o="EMPTY",i="EMPTY";return m.Observable.combineLatest(e,r.filter((function(e){var t=e.columnId,n=e.sectionId;return t&&o!==t?(o=t,!0):!(!n||i===n||(i=n,0))})).withLatestFrom(e.pluck("updateCurrentPage")).do((function(e){var t,n,r=(n=2,function(e){if(Array.isArray(e))return e}(t=e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i=[],a=!0,c=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);a=!0);}catch(e){c=!0,o=e}finally{try{a||null==n.return||n.return()}finally{if(c)throw o}}return i}}(t,n)||function(e,t){if(e){if("string"==typeof e)return Le(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Le(e,t):void 0}}(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),o=r[0],i=r[1];return i&&i(o)})).ignoreElements().startWith({}),(function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return Ne(Ne({},t.reduce((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;return Ne(Ne({},e),t)}),{})),{},{updateCurrentPage:n})}))}))),We=n(982030),Be=n(322762),_e=n.n(Be);function Ve(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function He(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ve(Object(n),!0).forEach((function(t){Fe(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ve(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Fe(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}(0,Me.setObservableConfig)(Ae.Z);const ze=(0,Me.compose)((0,Me.mapPropsStream)((function(e){var t=(0,Me.createEventHandler)(),n=t.handler,r=t.stream;return m.Observable.combineLatest(e,function(e,t){return t.map((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{interceptorTime:e.interceptorTime,updateCurrentPage:e.updateCurrentPage}})).distinctUntilKeyChanged("interceptorTime").switchMap((function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.interceptorTime,r=void 0===n?100:n,o=t.updateCurrentPage;return e.scan((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,n=t.id,r=t.visible,o=t.entry;return He(He({},e),{},Fe({},n,{visible:r,entry:o}))}),{}).debounceTime(r).map((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return _e()(Object.keys(e),(function(t){return e[t].visible?D()(e[t],"entry.boundingClientRect.top"):1/0}))})).do((function(e){o&&o({sectionId:e})})).ignoreElements()}))}(r,e).startWith({}),(function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return He(He({},t.reduce((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;return He(He({},e),t)}),{})),{},{onVisibilityChange:n})}))})));var Ue=n(675263),Ge=n.n(Ue),qe=n(993451),Ke=(n(707169),n(909041)),$e=n(967134),Qe=n(294184),Ye=n.n(Qe);function Xe(e){return Xe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Xe(e)}function Je(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function et(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function tt(e,t,n){return t&&et(e.prototype,t),n&&et(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function nt(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&rt(e,t)}function rt(e,t){return rt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},rt(e,t)}function ot(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=ct(e);if(t){var o=ct(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return it(this,n)}}function it(e,t){if(t&&("object"===Xe(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return at(e)}function at(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ct(e){return ct=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},ct(e)}function lt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var st="External Link",ut=function(e){nt(n,e);var t=ot(n);function n(){var e;Je(this,n);for(var r=arguments.length,o=new Array(r),i=0;i<r;i++)o[i]=arguments[i];return lt(at(e=t.call.apply(t,[this].concat(o))),"state",{expanded:!1}),lt(at(e),"toggle",(function(){e.setState((function(e){return{expanded:!e.expanded}}))})),e}return tt(n,[{key:"render",value:function(){var e=this.state.expanded,t=this.props,n=t.externalLinkOption,r=t.onSelectionChange,o=t.currentSelectOption,a=t.availableStorySections;return i().createElement("div",{className:"rdw-block-wrapper","aria-label":"rdw-block-control"},i().createElement($e.Dropdown,{className:"ms-rdw-link-options-dropdown",onChange:r,expanded:e,doExpand:this.toggle,doCollapse:this.toggle,onExpandEvent:this.toggle,title:"MSLinks"},i().createElement("span",null,o),i().createElement($e.DropdownOption,{active:!0,value:{value:n,label:n},key:n},"External Link"),a&&a.map((function(e){return i().createElement($e.DropdownOption,{active:e.id===o,value:{value:e.id,label:e.title||e.type||e.id},key:e.id},e.title||e.type||e.id)}))))}}]),n}(o.Component);lt(ut,"propTypes",{externalLinkOption:Ge().string,onSelectionChange:Ge().func,currentSelectOption:Ge().string,availableStorySections:Ge().array});var dt=function(e){nt(n,e);var t=ot(n);function n(){var e;Je(this,n);for(var r=arguments.length,o=new Array(r),i=0;i<r;i++)o[i]=arguments[i];return lt(at(e=t.call.apply(t,[this].concat(o))),"state",{showModal:!1,linkTarget:"",linkTitle:"",attributes:{},linkTargetOption:e.props.config.defaultTargetOption,currentSelectOption:"Select link target"}),lt(at(e),"removeLink",(function(){(0,e.props.onChange)("unlink")})),lt(at(e),"addLink",(function(){var t=e.props.onChange,n=e.state;t("link",n.linkTitle,n.linkTarget,n.linkTargetOption,n.attributes)})),lt(at(e),"updateValue",(function(t){e.setState(lt({},"".concat(t.target.name),t.target.value))})),lt(at(e),"onSelectionChange",(function(t){t.value===st?e.setState({linkTarget:"",attributes:{},currentSelectOption:t.label}):e.setState({linkTarget:t.value,attributes:{"data-geostory-interaction-type":"scrollTo","data-geostory-interaction-params":"".concat(t.value),"data-geostory-interaction-name":t.label},currentSelectOption:t.label})})),lt(at(e),"updateTargetOption",(function(t){e.setState({linkTargetOption:t.target.checked?"_blank":"_self"})})),lt(at(e),"hideModal",(function(){e.setState({showModal:!1})})),lt(at(e),"signalExpandShowModal",(function(){var t=e.props,n=t.onExpandEvent,r=t.currentState,o=r.link,i=r.selectionText,a=e.state.linkTargetOption;n();var c="Select link target";null!=o&&o.target&&o.target.length>0&&(c=st),null!=o&&o.attributes["data-geostory-interaction-name"]&&(c=o.attributes["data-geostory-interaction-name"]),e.setState({showModal:!0,linkTarget:o&&o.target||"",linkTargetOption:o&&o.targetOption||a,linkTitle:o&&o.title||i,attributes:o&&o.attributes||{},currentSelectOption:c})})),lt(at(e),"forceExpandAndShowModal",(function(){var t=e.props,n=t.doExpand,r=t.currentState,o=r.link,i=r.selectionText,a=e.state.linkTargetOption;n();var c="Select link target";null!=o&&o.target&&o.target.length>0&&(c=st),null!=o&&o.attributes["data-geostory-interaction-name"]&&(c=o.attributes["data-geostory-interaction-name"]),e.setState({showModal:!0,linkTarget:o&&o.target,linkTargetOption:o&&o.targetOption||a,linkTitle:o&&o.title||i,attributes:o&&o.attributes||{},currentSelectOption:c})})),e}return tt(n,[{key:"componentDidUpdate",value:function(e){e.expanded&&!this.props.expanded&&this.setState({showModal:!1,linkTarget:"",linkTitle:"",attributes:{},linkTargetOption:this.props.config.defaultTargetOption,currentSelectOption:"Select link target"})}},{key:"renderAddLinkModal",value:function(){var e=this.props,t=e.config.popupClassName,n=e.doCollapse,r=e.translations,o=e.availableStorySections,a=this.state,c=a.linkTitle,l=a.linkTarget,s=a.linkTargetOption,u=a.currentSelectOption;return i().createElement("div",{className:Ye()("rdw-link-modal",t),onClick:$e.stopPropagation},i().createElement("label",{className:"rdw-link-modal-label",htmlFor:"linkTitle"},r["components.controls.link.linkTitle"]),i().createElement("input",{id:"linkTitle",className:"rdw-link-modal-input",onChange:this.updateValue,onBlur:this.updateValue,name:"linkTitle",value:c}),i().createElement("label",{className:"rdw-link-modal-label",htmlFor:"linkTarget"},r["components.controls.link.linkTarget"]),i().createElement(ut,{externalLinkOption:st,currentSelectOption:u,onSelectionChange:this.onSelectionChange,availableStorySections:o}),u===st&&i().createElement(i().Fragment,null,i().createElement("input",{id:"linkTarget",className:"rdw-link-modal-input",onChange:this.updateValue,onBlur:this.updateValue,name:"linkTarget",value:l}),i().createElement("label",{className:"rdw-link-modal-target-option",htmlFor:"openLinkInNewWindow"},i().createElement("input",{id:"openLinkInNewWindow",type:"checkbox",defaultChecked:"_blank"===s,value:"_blank",onChange:this.updateTargetOption}),i().createElement("span",null,r["components.controls.link.linkTargetOption"]))),i().createElement("span",{className:"rdw-link-modal-buttonsection"},i().createElement("button",{className:"rdw-link-modal-btn",onClick:this.addLink,disabled:!l||!c},r["generic.add"]),i().createElement("button",{className:"rdw-link-modal-btn",onClick:n},r["generic.cancel"])))}},{key:"renderInFlatList",value:function(){var e=this.props,t=e.config,n=t.options,r=t.link,o=t.unlink,a=t.className,c=e.currentState,l=e.expanded,s=e.translations,u=this.state.showModal;return i().createElement("div",{className:Ye()("rdw-link-wrapper",a),"aria-label":"rdw-link-control"},n.indexOf("link")>=0&&i().createElement($e.Option,{value:"unordered-list-item",className:Ye()(r.className),onClick:this.signalExpandShowModal,"aria-haspopup":"true","aria-expanded":u,title:r.title||s["components.controls.link.link"]},i().createElement("img",{src:r.icon,alt:""})),n.indexOf("unlink")>=0&&i().createElement($e.Option,{disabled:!c.link,value:"ordered-list-item",className:Ye()(o.className),onClick:this.removeLink,title:o.title||s["components.controls.link.unlink"]},i().createElement("img",{src:o.icon,alt:""})),l&&u?this.renderAddLinkModal():void 0)}},{key:"renderInDropDown",value:function(){var e=this.props,t=e.expanded,n=e.onExpandEvent,r=e.doCollapse,o=e.doExpand,a=e.onChange,c=e.config,l=e.currentState,s=e.translations,u=c.options,d=c.link,p=c.unlink,f=c.className,y=c.dropdownClassName,b=c.title,m=this.state.showModal;return i().createElement("div",{className:"rdw-link-wrapper","aria-haspopup":"true","aria-label":"rdw-link-control","aria-expanded":t,title:b},i().createElement($e.Dropdown,{className:Ye()("rdw-link-dropdown",f),optionWrapperClassName:Ye()(y),onChange:a,expanded:t&&!m,doExpand:o,doCollapse:r,onExpandEvent:n},i().createElement("img",{src:(0,$e.getFirstIcon)(c),alt:""}),u.indexOf("link")>=0&&i().createElement($e.DropdownOption,{onClick:this.forceExpandAndShowModal,className:Ye()("rdw-link-dropdownoption",d.className),title:d.title||s["components.controls.link.link"]},i().createElement("img",{src:d.icon,alt:""})),u.indexOf("unlink")>=0&&i().createElement($e.DropdownOption,{onClick:this.removeLink,disabled:!l.link,className:Ye()("rdw-link-dropdownoption",p.className),title:p.title||s["components.controls.link.unlink"]},i().createElement("img",{src:p.icon,alt:""}))),t&&m?this.renderAddLinkModal():void 0)}},{key:"render",value:function(){return this.props.config.inDropdown?this.renderInDropDown():this.renderInFlatList()}}]),n}(o.Component);lt(dt,"propTypes",{expanded:Ge().bool,doExpand:Ge().func,doCollapse:Ge().func,onExpandEvent:Ge().func,config:Ge().object,onChange:Ge().func,currentState:Ge().object,translations:Ge().object,modalHandler:Ge().any});const pt=dt;function ft(e){return ft="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ft(e)}function yt(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function bt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function mt(e,t){return mt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},mt(e,t)}function vt(e,t){if(t&&("object"===ft(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return gt(e)}function gt(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ht(e){return ht=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},ht(e)}function Ot(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function wt(e,t,n){e.findEntityRanges((function(e){var t=e.getEntity();return null!==t&&"LINK"===n.getEntity(t).getType()}),t)}function Et(e){var t,n=e.showOpenOptionOnHover;return t=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&mt(e,t)}(l,e);var t,r,o,a,c=(o=l,a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=ht(o);if(a){var n=ht(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return vt(this,e)});function l(){var e;yt(this,l);for(var t=arguments.length,r=new Array(t),o=0;o<t;o++)r[o]=arguments[o];return Ot(gt(e=c.call.apply(c,[this].concat(r))),"state",{showPopOver:!1}),Ot(gt(e),"openLink",(function(){var t=e.props,n=t.entityKey,r=t.contentState.getEntity(n).getData().url,o=window.open(r,"blank");o&&o.focus()})),Ot(gt(e),"toggleShowPopOver",(function(){var t=!e.state.showPopOver;e.setState({showPopOver:t})})),Ot(gt(e),"renderDecorator",(function(){var t=e.props,r=t.children,o=t.entityKey,a=t.contentState.getEntity(o).getData(),c=a.url,l=a.targetOption,s=a.attributes,u=e.state.showPopOver;return s&&s["data-geostory-interaction-type"]?i().createElement("span",{className:"rdw-link-decorator-wrapper"},i().createElement("a",{"data-geostory-interaction-type":s["data-geostory-interaction-type"],"data-geostory-interaction-params":s["data-geostory-interaction-params"]},r)):i().createElement("span",{className:"rdw-link-decorator-wrapper",onMouseEnter:e.toggleShowPopOver,onMouseLeave:e.toggleShowPopOver},i().createElement("a",{href:c,target:l},r),u&&n?i().createElement("img",{src:$e.openlink,alt:"",onClick:e.openLink,className:"rdw-link-decorator-icon"}):void 0)})),e}return t=l,(r=[{key:"render",value:function(){return this.renderDecorator()}}])&&bt(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),l}(o.Component),Ot(t,"propTypes",{entityKey:Ge().string.isRequired,children:Ge().array,contentState:Ge().object}),t}const jt=function(e){return{strategy:wt,component:Et(e)}};var Pt=n(689265),St=n.n(Pt),Tt=n(717247),Ct=n.n(Tt),kt=function(e){var t=void 0;if(e instanceof HTMLAnchorElement){var n={};if(e.dataset&&void 0!==e.dataset.mention)n.url=e.href,n.text=e.innerHTML,n.value=e.dataset.value,t=Ke.Entity.__create("MENTION","IMMUTABLE",n);else{n.url=e.getAttribute&&e.getAttribute("href")||e.href,n.title=e.innerHTML,n.targetOption=e.target;var r=e.getAttribute&&e.getAttribute("data-geostory-interaction-type"),o=e.getAttribute&&e.getAttribute("data-geostory-interaction-params"),i=e.getAttribute&&e.getAttribute("data-geostory-interaction-name"),a={};i&&o&&r&&(a["data-geostory-interaction-type"]=r,a["data-geostory-interaction-params"]=o,a["data-geostory-interaction-name"]=i),n.attributes=a,t=Ke.Entity.__create("LINK","MUTABLE",n)}}return t},It=function(e,t){if("MENTION"===e.type)return'< href="'.concat(e.data.url,'" class="wysiwyg-mention" data-mention data-value="').concat(e.data.value,'">').concat(t,"</a>");if("LINK"===e.type){var n=e.data.targetOption||"_self",r=e.data.attributes;return r&&r["data-geostory-interaction-type"]?'<a data-geostory-interaction-name="'.concat(r["data-geostory-interaction-name"],'" data-geostory-interaction-type="').concat(r["data-geostory-interaction-type"],'" data-geostory-interaction-params="').concat(r["data-geostory-interaction-params"],"\" onclick=\"__geostory_interaction(type='scrollTo', '").concat(r["data-geostory-interaction-params"],"')\">").concat(t,"</a>"):'<a href="'.concat(e.data.url,'" target="').concat(n,'">').concat(t,"</a>")}if("IMAGE"===e.type){var o=e.data.alignment,i=o&&"none"!==o?"float: ".concat(o,";"):"display: block; margin: 0 auto 0 auto;";return'<img src="'.concat(e.data.src,'" alt="').concat(e.data.alt,'" style="height: ').concat(e.data.height,"; width: ").concat(e.data.width,"; ").concat(i,'" />')}return"EMBEDDED_LINK"===e.type?'<iframe width="'.concat(e.data.width,'" height="').concat(e.data.height,'" src="').concat(e.data.src,'" frameBorder="0"></iframe>'):t};function Dt(){return Dt=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Dt.apply(this,arguments)}function Mt(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function At(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function xt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?At(Object(n),!0).forEach((function(t){Nt(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):At(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Nt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Rt=(0,Me.compose)((0,Me.withProps)((function(e){var t=e.storyFonts,n=void 0===t?[]:t,r=e.placeholder,o=e.toolbarStyle,i=void 0===o?{}:o,a=e.className,c=void 0===a?"ms-text-editor":a,l=e.toolbar,s=void 0===l?{}:l;return{editorRef:function(e){return setTimeout((function(){return e&&e.focus&&e.focus()}),100)},stripPastedStyles:!0,placeholder:r,toolbarStyle:i,toolbar:xt({options:["fontFamily","blockType","fontSize","inline","textAlign","colorPicker","list","link","remove"],fontFamily:{options:n.length>0?n:d.Km,className:void 0,component:void 0,dropdownClassName:void 0},link:{inDropdown:!1,className:void 0,component:void 0,popupClassName:void 0,dropdownClassName:void 0,showOpenOptionOnHover:!0,defaultTargetOption:"_self",options:["link","unlink"],link:{icon:void 0,className:void 0},unlink:{icon:void 0,className:void 0},linkCallback:void 0},blockType:{inDropdown:!0,options:["Normal","H1","H2","H3","H4","H5","H6","Blockquote","Code"],className:void 0,component:void 0,dropdownClassName:void 0},inline:{options:["bold","italic","underline","strikethrough","monospace"],bold:{className:"".concat(c,"-toolbar-btn")},italic:{className:"".concat(c,"-toolbar-btn")},underline:{className:"".concat(c,"-toolbar-btn")},strikethrough:{className:"".concat(c,"-toolbar-btn")},code:{className:"".concat(c,"-toolbar-btn")}},textAlign:{left:{className:"".concat(c,"-toolbar-btn")},center:{className:"".concat(c,"-toolbar-btn")},right:{className:"".concat(c,"-toolbar-btn")},justify:{className:"".concat(c,"-toolbar-btn")}},fontSize:{options:[8,9,10,11,12,14,16,18,20,22,24,26,28,30,32,34,36,40,42,44,48,52,56,60,72,96,100,120],className:void 0,component:void 0,dropdownClassName:void 0},colorPicker:{className:"".concat(c,"-toolbar-btn")},remove:{className:"".concat(c,"-toolbar-btn")}},s),toolbarClassName:"".concat(c,"-toolbar"),wrapperClassName:"".concat(c,"-wrapper"),editorClassName:"".concat(c,"-main")}})),(0,Me.renderComponent)($e.Editor)),Lt=(0,Me.compose)((0,Me.lifecycle)({componentWillUnmount:function(){var e=this.props,t=e.editorState,n=e.save;(void 0===n?function(){}:n)(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";if(e){var n=1!==(0,Ke.convertToRaw)(e.getCurrentContent()).blocks.length||(0,Ke.convertToRaw)(e.getCurrentContent()).blocks[0].text,r=St()((0,Ke.convertToRaw)(e.getCurrentContent()),null,null,It);return n?r:t}return t}(t,d.gg))}}),(0,Me.withHandlers)({onBlur:function(e){var t=e.toggleEditing,n=void 0===t?function(){}:t;return function(){n(!1)}}}),(0,Me.withProps)((function(e){var t=e.sections;return{availableStorySections:(void 0===t?[]:t).reduce((function(e,t){var n,r=[];return[d.ID.IMMERSIVE,d.ID.CAROUSEL].includes(t.type)?t.contents.forEach((function(e){r.push(e)})):r.push(t),[].concat(function(e){if(Array.isArray(e))return Mt(e)}(n=e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(n)||function(e,t){if(e){if("string"==typeof e)return Mt(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Mt(e,t):void 0}}(n)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),r)}),[])}})),(0,Me.withProps)((function(e){var t=e.availableStorySections,n=void 0===t?[]:t;return{toolbar:{link:{inDropdown:!1,className:void 0,component:function(e){return i().createElement(pt,Dt({},e,{availableStorySections:n}))},popupClassName:void 0,dropdownClassName:void 0,showOpenOptionOnHover:!0,defaultTargetOption:"_self",options:["link","unlink"],link:{icon:void 0,className:void 0},unlink:{icon:void 0,className:void 0},linkCallback:void 0,getLinkDecorator:jt}}}})),Rt);const Zt=(0,Me.compose)((0,Me.withState)("contentEditing","setContentEditing",!1),(0,Me.withState)("editorState","onEditorStateChange"),(0,Me.withHandlers)({toggleEditing:function(e){var t=e.bubblingTextEditing,n=void 0===t?function(){}:t,r=e.sectionType,o=e.onEditorStateChange,i=void 0===o?function(){}:o,a=e.setContentEditing,c=void 0===a?function(){}:a;return function(e,t){if(e){var o=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=Ct()(e,null,kt),n=Ke.ContentState.createFromBlockArray(t.contentBlocks);return Ke.EditorState.createWithContent(n)}(t);if(r===d.ID.TITLE&&"unstyled"===Ke.RichUtils.getCurrentBlockType(o)){var a=o.getCurrentContent();a=Ke.Modifier.setBlockType(a,Ke.EditorState.createWithContent(a).getSelection(),"header-one"),o=Ke.EditorState.createWithContent(a)}i(o),c(!0),n(!0)}else c(!1),n(!1)}}}),(0,Me.branch)((function(e){return!!e.contentEditing}),Lt)),Wt=(0,Me.compose)((0,Me.withHandlers)({save:function(e){var t=e.update,n=void 0===t?function(){}:t;return function(e){return n("html",e)}}}),(0,Me.branch)((function(e){return e.mode===d.nl.EDIT}),Zt),(0,Me.compose)((0,Me.withPropsOnChange)(["sectionType"],(function(e){var t=e.sectionType;return{placeholder:d.ID.TITLE===t?"geostory.builder.defaults.htmlTitlePlaceholder":"geostory.builder.defaults.htmlPlaceholder",placeholderTag:d.ID.TITLE===t?"h1":"p"}})),(0,qe.Z)("placeholder")))((function(e){var t=e.placeholder,n=e.placeholderTag,r=void 0===n?"p":n,o=e.id,a=e.toggleEditing,c=void 0===a?function(){}:a,l=e.html,s=e.mode;return i().createElement("div",{className:"ms-text-wrapper"},l!==d.gg&&i().createElement("div",{id:o,onClick:function(){return c(!0,l)},dangerouslySetInnerHTML:{__html:l}}),(!l||l===d.gg)&&s===d.nl.EDIT&&i().createElement("div",{className:"ms-text-placeholder",id:"placeholder"+o,onClick:function(){return c(!0,l===d.gg?"":l)},dangerouslySetInnerHTML:{__html:"<".concat(r,">").concat(t,"</").concat(r,">")}}))}));var Bt=n(882017),_t=n(61018),Vt=n(757588),Ht=n(282467),Ft=n(805346),zt=n(399534),Ut=(0,Me.branch)((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.src,n=void 0===t?"":t,r=e.viewHeight,o=e.size;return!n||!r||!o}),(0,We.Z)((function(){return!0}),(function(){return{glyph:"code"}})));const Gt=(0,Me.compose)(Ut)((function(e){var t=e.src,n=e.size,r=e.viewHeight;return i().createElement("div",{className:"ms-webpage-wrapper"},i().createElement("iframe",{src:t,height:"".concat((0,d.t4)(n,r),"px")}))}));var qt=n(611847),Kt=n(737275),$t=n(748759),Qt=n(23279),Yt=n.n(Qt);function Xt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Jt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Xt(Object(n),!0).forEach((function(t){en(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Xt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function en(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function tn(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var nn=function(e){var t,n,r=e.id,a=e.onLoad,c=e.loading,l=e.debounceTime,s=e.children,u=e.loaderComponent,d=e.loaderStyle,p=(t=(0,$t.YD)(),n=2,function(e){if(Array.isArray(e))return e}(t)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i=[],a=!0,c=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);a=!0);}catch(e){c=!0,o=e}finally{try{a||null==n.return||n.return()}finally{if(c)throw o}}return i}}(t,n)||function(e,t){if(e){if("string"==typeof e)return tn(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?tn(e,t):void 0}}(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),f=p[0],y=p[1],b=(0,o.useRef)(null),m=u;return(0,o.useEffect)((function(){return b.current=Yt()((function(e){a(e)}),l),function(){b.current.cancel()}}),[]),(0,o.useEffect)((function(){y&&c&&b.current(r),!y&&c&&b.current.cancel()}),[y,c,r]),i().createElement("div",{ref:f,className:"ms-visibility-container"},c?m?i().createElement(m,{style:Jt({},d)}):null:(0,o.cloneElement)(s,{inView:y}))};nn.propTypes={id:Ge().string,debounceTime:Ge().number,loading:Ge().bool,onLoad:Ge().func,loaderComponent:Ge().oneOfType([Ge().element,Ge().func])},nn.defaultProps={id:"",debounceTime:300,loading:!0,onLoad:function(){},loaderComponent:null};const rn=nn;var on=n(532425);function an(e){return an="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},an(e)}function cn(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function ln(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function sn(e,t){return sn=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},sn(e,t)}function un(e,t){if(t&&("object"===an(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return dn(e)}function dn(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function pn(e){return pn=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},pn(e)}function fn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var yn=function(){return i().createElement("div",{className:"ms-media-loader"},i().createElement(on.Z,{size:52}))},bn=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&sn(e,t)}(c,e);var t,n,r,o,a=(r=c,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=pn(r);if(o){var n=pn(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return un(this,e)});function c(){var e;cn(this,c);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return fn(dn(e=a.call.apply(a,[this].concat(n))),"state",{url:e.props.src||"",error:!1,loading:!0}),fn(dn(e),"updateURL",(function(t){var n=t.target.value;e.setState({url:n})})),fn(dn(e),"save",(function(){var t=e.state.url,n=!(0,qt.RS)(t,(0,Kt.u8)("GeoStoryValidIframeURLRegex"));e.setState({error:n}),n||e.props.onChange(t)})),e}return t=c,(n=[{key:"render",value:function(){var e=this,t=this.props,n=t.onClose,r=t.editURL,o=this.state,a=o.url,c=o.error;return i().createElement(i().Fragment,null,i().createElement(zt.Z,null,i().createElement(_t.Z,{modal:!0,show:r,onClickOut:function(e){return e.preventDefault()&&e.stopPropagation()},title:i().createElement(Ft.Z,{msgId:"geostory.webPageCreator.title"}),onClose:n,id:"web-page-creator",footer:i().createElement(Ht.Z,{bsSize:"small",onClick:this.save},i().createElement(Ft.Z,{msgId:"geostory.webPageCreator.saveButton"}))},c&&i().createElement("div",{className:"dropzone-errorBox alert-danger"},i().createElement(Ft.Z,{msgId:"geostory.webPageCreator.error"})),i().createElement(Vt.FormGroup,{controlId:"WEBPAGE_URL",validationState:c&&"error"},i().createElement(Vt.ControlLabel,null,i().createElement(Ft.Z,{msgId:"geostory.webPageCreator.url.label"})),i().createElement(Vt.FormControl,{label:"URL",type:"text",value:a,onChange:this.updateURL,required:!0})))),this.props.lazy?i().createElement(rn,{key:this.props.id,id:this.props.id,debounceTime:this.props.debounceTime,loading:this.state.loading,onLoad:function(){return e.setState({loading:!1})},loaderComponent:yn},i().createElement(Gt,this.props)):i().createElement(Gt,this.props))}}])&&ln(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),c}(i().PureComponent);fn(bn,"propTypes",{editURL:Ge().bool,onClose:Ge().func,onChange:Ge().func,src:Ge().string,id:Ge().string,debounceTime:Ge().number,lazy:Ge().bool}),fn(bn,"defaultProps",{lazy:!0});var mn=(0,Me.compose)((0,Me.withHandlers)({onClose:function(e){var t=e.update,n=void 0===t?function(){}:t;return function(){return n("editURL",!1,"merge")}}}))(bn);const vn=(0,a.connect)(null,{onChange:y.YM})(mn);var gn=["type"];function hn(){return hn=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},hn.apply(this,arguments)}var On=function(e){var t=e.type;return i().createElement("div",{className:"ms-content ms-content-unknown"},'warning: unknown content type "'.concat(t,'"'))};const wn=function(e){var t=e.type,n=function(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}(e,gn),r=function(e){switch(e){case d.bT.TEXT:return Wt;case d.bT.MEDIA:case d.Tr.IMAGE:case d.Tr.MAP:case d.Tr.VIDEO:return Bt.ZP;case d.bT.WEBPAGE:return vn;default:return On}}(t);return i().createElement(r,hn({type:t},n))};var En=n(725288),jn=n(80717);function Pn(e){return Pn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Pn(e)}var Sn=["onClick"];function Tn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Cn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Tn(Object(n),!0).forEach((function(t){xn(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Tn(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function kn(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function In(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Dn(e,t){return Dn=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Dn(e,t)}function Mn(e,t){if(t&&("object"===Pn(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function An(e){return An=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},An(e)}function xn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Nn=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Dn(e,t)}(c,e);var t,n,r,o,a=(r=c,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=An(r);if(o){var n=An(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return Mn(this,e)});function c(){return kn(this,c),a.apply(this,arguments)}return t=c,n=[{key:"UNSAFE_componentWillReceiveProps",value:function(e){!this.trigger||e.containerWidth===this.props.containerWidth&&e.containerHeight===this.props.containerHeight||this.trigger.hide()}},{key:"render",value:function(){var e=this;return i().createElement(En.Z,{className:"add-bar",popoverClassName:"add-bar-popover",content:i().createElement(jn.Z,{btnDefaultProps:{className:"square-button btn-tray"},buttons:this.props.buttons.map((function(t){var n=t.onClick,r=void 0===n?function(){}:n;return Cn(Cn({},function(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}(t,Sn)),{},{onClick:function(){for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];r.apply(void 0,n),e.trigger.hide(),n[0]&&n[0].preventDefault&&n[0].preventDefault()}})}))}),ref:function(t){t&&(e.trigger=t.trigger)},placement:"top"},i().createElement(Ht.Z,{className:this.props.addButtonClassName},i().createElement(Vt.Glyphicon,{glyph:"plus"})))}}],n&&In(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),c}(i().Component);xn(Nn,"propTypes",{id:Ge().string,type:Ge().string,buttons:Ge().array,containerWidth:Ge().oneOfType([Ge().number,Ge().string]),containerHeight:Ge().oneOfType([Ge().number,Ge().string]),addButtonClassName:Ge().string}),xn(Nn,"defaultProps",{id:"",type:"",buttons:[],containerWidth:0,containerHeight:0,addButtonClassName:""});const Rn=Nn;var Ln=["id"];function Zn(e){return function(e){if(Array.isArray(e))return Wn(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return Wn(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Wn(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Wn(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Bn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function _n(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Bn(Object(n),!0).forEach((function(t){Vn(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Bn(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Vn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Hn(){return Hn=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Hn.apply(this,arguments)}function Fn(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}const zn=function(e){var t=e.viewWidth,n=e.viewHeight,r=e.className,o=e.contentProps,a=void 0===o?{}:o,c=e.addButtons,l=void 0===c?[]:c,s=e.tools,u=void 0===s?[]:s,p=e.contents,f=void 0===p?[]:p,y=e.ContentComponent,b=void 0===y?wn:y,m=e.mode,v=e.sectionType,g=e.editMedia,h=void 0===g?function(){}:g,O=e.editWebPage,w=void 0===O?function(){}:O,E=e.add,j=void 0===E?function(){}:E,P=e.update,S=void 0===P?function(){}:P,T=e.remove,C=void 0===T?function(){}:T,k=e.bubblingTextEditing,I=void 0===k?function(){}:k,D=e.storyTheme,M=e.sections,A=void 0===M?[]:M,x=e.storyFonts,N=e.innerRef;return i().createElement("div",{ref:N,className:r},f.reduce((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],r=arguments.length>1?arguments[1]:void 0,o=r.id,c=Fn(r,Ln),s=[i().createElement(b,Hn({id:o,key:"".concat(o,"-content"),mode:m,viewWidth:t,sectionType:v,viewHeight:n,editMedia:function(e){for(var t=e.path,n=void 0===t?"":t,r=arguments.length,i=new Array(r>1?r-1:0),a=1;a<r;a++)i[a-1]=arguments[a];return h.apply(void 0,[{path:'contents[{"id": "'.concat(o,'"}]')+n}].concat(i))},editWebPage:function(e){for(var t=e.path,n=void 0===t?"":t,r=arguments.length,i=new Array(r>1?r-1:0),a=1;a<r;a++)i[a-1]=arguments[a];return w.apply(void 0,[{path:'contents[{"id": "'.concat(o,'"}]')+n}].concat(i))},add:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return j.apply(void 0,['contents[{"id": "'.concat(o,'"}].')+e].concat(n))},update:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return S.apply(void 0,['contents[{"id": "'.concat(o,'"}].')+e].concat(n))},remove:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return C.apply(void 0,['contents[{"id": "'.concat(o,'"}]')+(e?"."+e:"")].concat(n))}},a,c,{storyTheme:D,storyFonts:x,bubblingTextEditing:I,tools:u&&u[c.type],sections:A}))];return m===d.nl.EDIT&&l.length>0&&s.push(i().createElement(Rn,{key:"".concat(o,"-content-add-buttons"),containerWidth:t,containerHeight:n,buttons:l.map((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return _n(_n({},e),{},{onClick:function(){return j("contents",o,e.template)}})}))})),[].concat(Zn(e),s)}),[]))};n(966337);var Un=["onVisibilityChange","rootSelector"],Gn=["intersectionObserverOptions","onVisibilityChange"];function qn(){return qn=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},qn.apply(this,arguments)}function Kn(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}const $n=function(e){return(0,Me.compose)((0,Me.withHandlers)({onVisibilityChange:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.id,n=e.onVisibilityChange,r=void 0===n?function(){}:n;return function(e,n){return r({id:t,visible:e,entry:n})}}}),function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.onVisibilityChange,n=(e.rootSelector,Kn(e,Un));return function(e){return function(r){var o=r.intersectionObserverOptions,a=void 0===o?{}:o,c=r.onVisibilityChange,l=Kn(r,Gn),s=t||c;return i().createElement($t.df,qn({},n,a,{onChange:s}),(function(t){var n=t.inView,r=t.ref,o=t.entry;return i().createElement(e,qn({},l,{inView:n,inViewRef:r,inViewEntry:o}))}))}}}(e))};var Qn=n(90085),Yn=n(212610),Xn=n(313311),Jn=n.n(Xn),er=n(623560),tr=n.n(er),nr=n(618446),rr=n.n(nr);function or(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i=[],a=!0,c=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);a=!0);}catch(e){c=!0,o=e}finally{try{a||null==n.return||n.return()}finally{if(c)throw o}}return i}}(e,t)||function(e,t){if(e){if("string"==typeof e)return ir(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ir(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ir(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var ar=(0,Yn.Z)(Vt.DropdownButton);function cr(e){var t=e.value,n=e.options,r=void 0===n?[]:n,a=e.onSelect,c=void 0===a?function(){}:a,l=e.glyph,s=void 0===l?"":l,u=e.tooltipId,d=e.pullRight,p=void 0!==d&&d,f=e.className,y=void 0===f?"square-button-md no-border":f,b=e.disabled,m=e.noTooltipWhenDisabled,v=void 0!==m&&m,g=e.hideMenuItem,h=void 0===g?function(){return!1}:g,O=e.shouldClose,w=e.showSelectionInTitle,E=void 0===w||w,j=or((0,o.useState)(!1),2),S=j[0],T=j[1],C=or((0,o.useState)(!1),2),k=C[0],I=C[1],D=(Jn()(r,(function(e){return rr()(e.value,t)}))||{}).glyph;return(0,o.useEffect)((function(){b&&T(!1)}),[b]),i().createElement(ar,{noCaret:!0,open:S,noTooltipWhenDisabled:v,tooltipId:u,pullRight:p,className:y,disabled:b,title:i().createElement(Vt.Glyphicon,{glyph:E&&D||s}),onToggle:function(e,n,r){return k||"select"===(null==r?void 0:r.source)||O&&!O(t,n)?null:T(e)}},r.map((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=(null==e?void 0:e.Component)||Vt.MenuItem;return h(t,e)?null:i().createElement(n,{key:e.value,selected:t,value:e.value,active:tr()(null==e?void 0:e.isActive)&&e.isActive(t)||!P()(t)&&t===e.value,onClick:null!=e&&e.Component?c:function(){return c(e.value)},onActive:function(e){return I(e)}},e.label)})))}var lr=n(312122),sr=n(911766),ur=n(513218),dr=n.n(ur);function pr(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function fr(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?pr(Object(n),!0).forEach((function(t){yr(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):pr(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function yr(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function br(){return br=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},br.apply(this,arguments)}function mr(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var vr=(0,lr.Z)(Qn.Z),gr={primary:"btn-primary",default:"btn-default"},hr=function(e){var t=e.editMap,n=void 0!==t&&t,r=e.align,o=e.sectionType,a=e.size,c=e.update,l=void 0===c?function(){}:c,s=e.filterOptions,u=e.pullRight,d=e.sizeType,p=function(e,t){var n,r,o="horizontal",i="",a=(n=e&&e.split(",")||[],r=2,function(e){if(Array.isArray(e))return e}(n)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i=[],a=!0,c=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);a=!0);}catch(e){c=!0,o=e}finally{try{a||null==n.return||n.return()}finally{if(c)throw o}}return i}}(n,r)||function(e,t){if(e){if("string"==typeof e)return mr(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?mr(e,t):void 0}}(n,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),c=a[0],l=a[1],s=e,u="resize-horizontal";return t===o?(i="h-",s=c):"vertical"===t&&(i="v-",s=l,u="resize-vertical"),{sizeProp:function(e){return t?"".concat(t===o?e:c,",").concat("vertical"===t?e:l):e},pre:i,_size:s,glyph:u}}(a,d),f=p.pre,y=p._size,b=p.glyph,m=p.sizeProp;return i().createElement(cr,br({value:y,noTooltipWhenDisabled:!0,disabled:n,glyph:b,pullRight:u||("right"===r||y==="".concat(f,"full")||y==="".concat(f,"large"))&&!o,tooltipId:"geostory.contentToolbar.contentSize",options:[{value:"".concat(f,"small"),glyph:"size-small",label:i().createElement(Ft.Z,{msgId:"geostory.contentToolbar.smallSizeLabel"})},{value:"".concat(f,"medium"),glyph:"size-medium",label:i().createElement(Ft.Z,{msgId:"geostory.contentToolbar.mediumSizeLabel"})},{value:"".concat(f,"large"),glyph:"size-large",label:i().createElement(Ft.Z,{msgId:"geostory.contentToolbar.largeSizeLabel"})},{value:"".concat(f,"full"),glyph:"size-extra-large",label:i().createElement(Ft.Z,{msgId:"geostory.contentToolbar.fullSizeLabel"})}].filter((function(e){return!s||s(e)})),onSelect:function(e){return l("size",m(e))}},d&&{showSelectionInTitle:!1}))},Or=function(e){var t=e.editMap,n=void 0!==t&&t,r=e.align,o=e.sectionType,a=e.size,c=e.update,l=void 0===c?function(){}:c;return i().createElement(cr,{value:r,noTooltipWhenDisabled:!0,disabled:"full"===a||n,glyph:"align-center",pullRight:("right"===r||"full"===a||"large"===a)&&!o,tooltipId:"geostory.contentToolbar.contentAlign",options:[{value:"left",label:i().createElement(Ft.Z,{msgId:"geostory.contentToolbar.leftAlignLabel"}),glyph:"align-left"},{value:"center",label:i().createElement(Ft.Z,{msgId:"geostory.contentToolbar.centerAlignLabel"}),glyph:"align-center"},{value:"right",label:i().createElement(Ft.Z,{msgId:"geostory.contentToolbar.rightAlignLabel"}),glyph:"align-right"}],onSelect:function(e){return l("align",e)}})},wr=function(e){var t=e.editMap,n=void 0!==t&&t,r=e.theme,o=e.storyTheme,a=e.align,c=e.sectionType,l=e.update,s=void 0===l?function(){}:l,u=e.themeProps,d=e.size;return i().createElement(cr,{value:r,noTooltipWhenDisabled:!0,pullRight:("right"===a||"full"===d||"large"===d)&&!c,glyph:"dropper",tooltipId:"geostory.contentToolbar.contentTheme",disabled:n,shouldClose:function(e,t){var n,r;return dr()(e)&&"ms-color-picker-cover"!==(null==t||null===(n=t.target)||void 0===n||null===(r=n.getAttribute)||void 0===r?void 0:r.call(n,"class"))||E()(e)||void 0===e},hideMenuItem:function(e,t){return"custom"===(null==e?void 0:e.value)&&"custom"!==(null==t?void 0:t.value)},options:[{value:"",isActive:function(e){return void 0===e||""===e||dr()(e)&&(void 0===e.value||""===e.value)},label:i().createElement(Ft.Z,{msgId:"geostory.contentToolbar.defaultThemeLabel"})},{value:"bright",isActive:function(e){return"bright"===(null==e?void 0:e.value)||"bright"===e},label:i().createElement(Ft.Z,{msgId:"geostory.contentToolbar.brightThemeLabel"})},{value:"dark",isActive:function(e){return"dark"===(null==e?void 0:e.value)||"dark"===e},label:i().createElement(Ft.Z,{msgId:"geostory.contentToolbar.darkThemeLabel"})},{value:"custom",Component:function(e){return i().createElement(sr.H,br({},e,{disableBackgroundAlpha:null==u?void 0:u.disableBackgroundAlpha,disableShadow:null==u?void 0:u.disableShadow,disableTextColor:null==u?void 0:u.disableTextColor,onUpdate:s,storyTheme:o}))}}],onSelect:function(e){return s("theme",fr(fr({},dr()(r)&&r),{},{value:e}))}})},Er=function(e){var t=e.editMap,n=void 0!==t&&t,r=e.forceDelBtnDisable,o=void 0!==r&&r,a=e.path,c=e.remove,l=void 0===c?function(){}:c,s=e.bsStyle;return i().createElement(vr,{glyph:"trash",visible:!0,noTooltipWhenDisabled:!0,disabled:n||o,className:"".concat("square-button-md no-border"," ").concat(s&&gr[s]),tooltipId:"geostory.contentToolbar.remove",confirmTitle:i().createElement(Ft.Z,{msgId:"geostory.contentToolbar.removeConfirmTitle"}),confirmContent:i().createElement(Ft.Z,{msgId:"geostory.contentToolbar.removeConfirmContent"}),onClick:function(){l(a)}})},jr=n(455877),Pr=n.n(jr),Sr=["editMap","map","update"],Tr=["tools","children"];function Cr(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function kr(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Cr(Object(n),!0).forEach((function(t){Ir(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Cr(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Ir(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Dr(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var Mr={size:function(e){return{renderButton:i().createElement(hr,e)}},align:function(e){return{renderButton:i().createElement(Or,e)}},theme:function(e){return{renderButton:i().createElement(wr,e)}},fit:function(e){var t=e.editMap,n=void 0!==t&&t,r=e.fit,o=e.update,i=void 0===o?function(){}:o;return{value:r,glyph:"contain"===r?"fit-cover":"fit-contain",disabled:n,visible:!0,tooltipId:"contain"===r?"geostory.contentToolbar.cover":"geostory.contentToolbar.fit",onClick:function(){return i("fit","contain"===r?"cover":"contain")}}},cover:function(e){var t=e.editMap,n=void 0!==t&&t,r=e.cover,o=e.updateSection,i=void 0===o?function(){}:o;return{value:r,glyph:r?"height-auto":"height-view",visible:!0,disabled:n,tooltipId:r?"geostory.contentToolbar.contentHeightAuto":"geostory.contentToolbar.contentHeightView",onClick:function(){return i({cover:!r},"merge")}}},editMedia:function(e){var t=e.editMap,n=void 0!==t&&t,r=e.path,o=e.editMedia,i=void 0===o?function(){}:o,a=e.sectionType;return{glyph:"pencil","data-button":"pencil",visible:!0,disabled:n,tooltipId:"geostory.contentToolbar.editMedia",onClick:function(){i({path:r},r?a:"")}}},remove:function(e){return{renderButton:i().createElement(Er,e)}},editMap:function(e){var t=e.editMap,n=void 0!==t&&t,r=e.map,o=e.update,i=void 0===o?function(){}:o,a=Dr(e,Sr);return{glyph:"map-edit",visible:!0,disabled:n,bsStyle:n?"success":"default",tooltipId:"geostory.contentToolbar.editMap",onClick:function(){var e=null!=r?r:a,t=e.center,o=e.zoom,c=e.resolution;i("editMap",!n),!n&&i("map",{center:t,zoom:o,mapStateSource:Pr()(),resolution:c,resetPanAndZoom:!1},"merge")}}},editURL:function(e){var t=e.editURL,n=void 0!==t&&t,r=e.path,o=e.editWebPage,i=void 0===o?function(){}:o;return{glyph:"pencil",visible:!0,disabled:n,bsStyle:n?"success":"default",tooltipId:"geostory.contentToolbar.editURL",onClick:function(){i({path:r})}}},muted:function(e){var t=e.update,n=e.muted;return{glyph:n?"muted":"audio",visible:!0,active:!n,tooltipId:n?"geostory.contentToolbar.enableAudio":"geostory.contentToolbar.disableAudio",onClick:function(){t("muted",!n)}}},autoplay:function(e){var t=e.update,n=e.autoplay;return{glyph:"play-circle",visible:!("cover"===e.fit),active:n,tooltipId:n?"geostory.contentToolbar.disableAutoplay":"geostory.contentToolbar.enableAutoplay",onClick:function(){t("autoplay",!n)}}},loop:function(e){var t=e.update,n=e.loop;return{glyph:"loop",visible:!("cover"===e.fit),active:n,tooltipId:n?"geostory.contentToolbar.disableLoop":"geostory.contentToolbar.enableLoop",onClick:function(){t("loop",!n)}}},showCaption:function(e){var t=e.editMap,n=void 0!==t&&t,r=e.update,o=e.showCaption,i=e.caption,a=e.description;return{glyph:"caption",visible:!(!i&&!a),disabled:n,active:!(!o||n),tooltipId:o?"geostory.contentToolbar.hideCaption":"geostory.contentToolbar.showCaption",onClick:function(){r("showCaption",!o)}}},add:function(e){var t=e.editMap,n=void 0!==t&&t,r=e.addDisabled,o=void 0!==r&&r,i=e.add,a=void 0===i?function(){}:i,c=e.bsStyle;return{glyph:"plus",visible:!0,bsStyle:void 0===c?"default":c,tooltipId:"geostory.contentToolbar.add",disabled:n||o,onClick:a}},edit:function(e){var t=e.editMap,n=void 0!==t&&t,r=e.edit,o=void 0===r?function(){}:r,i=e.bsStyle;return{glyph:"pencil",visible:!0,bsStyle:void 0===i?"default":i,tooltipId:"geostory.contentToolbar.edit",disabled:n,onClick:o}},marker:function(e){var t=e.editMap,n=void 0!==t&&t,r=e.markerDisabled,o=void 0!==r&&r,i=e.marker,a=void 0===i?function(){}:i,c=e.bsStyle;return{glyph:"map-marker",visible:!0,tooltipId:"geostory.contentToolbar.marker",bsStyle:void 0===c?"default":c,disabled:n||o,onClick:a}},closeDraw:function(e){var t=e.editMap,n=void 0!==t&&t,r=e.bsStyle,o=void 0===r?"danger":r,i=e.update,a=void 0===i?function(){}:i,c=e.onEnableDraw,l=void 0===c?function(){}:c;return{glyph:"1-close",visible:!0,"data-button":"close-draw",tooltipId:"geostory.contentToolbar.closeMapEditing",bsStyle:o,disabled:!n,onClick:function(){l(null),a("editMap",!n)}}}};function Ar(e){var t=e.tools,n=void 0===t?[]:t,r=e.children,o=Dr(e,Tr);return i().createElement("div",{className:"ms-content-toolbar"},i().createElement(jn.Z,{btnDefaultProps:{className:"square-button-md no-border",noTooltipWhenDisabled:!0},buttons:n.filter((function(e){return(null==e?void 0:e.id)&&Mr[e.id]||Mr[e]})).map((function(e){return(null==e?void 0:e.id)&&Mr[e.id](kr(kr({},o),e))||Mr[e](o)}))}),r)}var xr=["id","inViewRef","innerRef","children","type","contentWrapperStyle","contentToolbar","mode"];function Nr(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Rr(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Nr(Object(n),!0).forEach((function(t){Lr(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Nr(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Lr(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const Zr=function(e){var t=e.id,n=e.inViewRef,r=e.innerRef,o=e.children,a=e.type,c=e.contentWrapperStyle,l=e.contentToolbar,s=e.mode,u=function(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}(e,xr),p=l||Ar;return i().createElement("div",{id:t,ref:n,style:Rr(Rr({},c),u.hideContent&&{display:"none"}),className:"ms-content ms-content-".concat(a).concat((0,d.w)(u))},i().createElement("div",{className:"ms-content-body",ref:r,style:(0,d.cy)(u)},s===d.nl.EDIT&&i().createElement(p,u),o))};function Wr(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Br(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Wr(Object(n),!0).forEach((function(t){_r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Wr(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function _r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Vr=(0,Me.compose)(function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(e){return Me.nest.apply(void 0,t.concat([e]))}}(Zr),(0,Me.setDisplayName)("ColumnContent"))(wn),Hr=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Br({id:"size",filterOptions:function(e){return"full"!==e.value},pullRight:e},t)};const Fr=(0,Me.compose)((0,Me.branch)((function(e){var t=e.type,n=e.sectionType;return[d.ID.IMMERSIVE,d.ID.CAROUSEL].includes(n)&&t===d.bT.COLUMN}),$n({threshold:[0,.25,.5,.75]})),function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(e){return Me.nest.apply(void 0,t.concat([e]))}}(Zr),(0,Me.setDisplayName)("SectionContent"),(0,Me.branch)((function(e){return e.type===d.bT.COLUMN}),(0,Me.renderComponent)((function(e){var t,n=e.viewWidth,r=e.viewHeight,o=e.contents,a=void 0===o?[]:o,c=e.mode,l=e.add,s=void 0===l?function(){}:l,u=e.editMedia,p=void 0===u?function(){}:u,f=e.editWebPage,y=void 0===f?function(){}:f,b=e.update,m=void 0===b?function(){}:b,v=e.remove,g=void 0===v?function(){}:v,h=e.bubblingTextEditing,O=void 0===h?function(){}:h,w=e.expandable,E=e.mediaViewer,j=e.contentToolbar,P=e.sections,S=void 0===P?[]:P,T=e.sectionType,C=e.overrideTools,k=void 0===C?function(e){return e}:C,I=e.storyFonts;return i().createElement(zn,{className:"ms-column-contents",ContentComponent:Vr,contents:a,mode:c,add:s,editMedia:p,editWebPage:y,update:m,remove:g,viewWidth:n,viewHeight:r,bubblingTextEditing:O,sectionType:T,contentProps:{expandable:w,mediaViewer:E,contentToolbar:j},sections:S,storyFonts:I,tools:k((t={},_r(t,d.bT.TEXT,["remove"]),_r(t,d.Tr.IMAGE,["editMedia",Hr(),"showCaption","remove"]),_r(t,d.Tr.MAP,["editMedia","editMap",Hr(!0),"showCaption","remove"]),_r(t,d.bT.WEBPAGE,[Hr(!0,{sizeType:"horizontal"}),"editURL",Hr(!0,{sizeType:"vertical",filterOptions:function(e){return"v-full"!==e.value}}),"remove"]),_r(t,d.Tr.VIDEO,["editMedia","muted","autoplay","loop","showCaption","remove"]),t)),addButtons:[{glyph:"sheet",tooltipId:"geostory.addTextContent",template:d.bT.TEXT},{glyph:"picture",tooltipId:"geostory.addMediaContent",template:d.bT.MEDIA},{glyph:"webpage",tooltipId:"geostory.addWebPageContent",template:d.bT.WEBPAGE}]})}))))(wn),zr=(0,Me.compose)((0,Me.defaultProps)({ContentComponent:Fr}),(0,Me.withHandlers)({editMedia:function(e){var t=e.editMedia,n=void 0===t?function(){}:t,r=e.sectionId;return function(e){for(var t=e.path,o=arguments.length,i=new Array(o>1?o-1:0),a=1;a<o;a++)i[a-1]=arguments[a];return n.apply(void 0,[{path:'sections[{"id": "'.concat(r,'"}].')+t}].concat(i))}},editWebPage:function(e){var t=e.editWebPage,n=void 0===t?function(){}:t,r=e.sectionId;return function(e){for(var t=e.path,o=arguments.length,i=new Array(o>1?o-1:0),a=1;a<o;a++)i[a-1]=arguments[a];return n.apply(void 0,[{path:'sections[{"id": "'.concat(r,'"}].')+t}].concat(i))}},add:function(e){var t=e.add,n=void 0===t?function(){}:t,r=e.sectionId;return function(e){for(var t=arguments.length,o=new Array(t>1?t-1:0),i=1;i<t;i++)o[i-1]=arguments[i];return n.apply(void 0,['sections[{"id": "'.concat(r,'"}].')+e].concat(o))}},update:function(e){var t=e.update,n=void 0===t?function(){}:t,r=e.sectionId;return function(e){for(var t=arguments.length,o=new Array(t>1?t-1:0),i=1;i<t;i++)o[i-1]=arguments[i];return n.apply(void 0,['sections[{"id": "'.concat(r,'"}].')+e].concat(o))}},remove:function(e){var t=e.remove,n=void 0===t?function(){}:t,r=e.sectionId;return function(e){for(var t=arguments.length,o=new Array(t>1?t-1:0),i=1;i<t;i++)o[i-1]=arguments[i];return n.apply(void 0,['sections[{"id": "'.concat(r,'"}].')+e].concat(o))}}}),(0,Me.setDisplayName)("SectionContents"))(zn);var Ur=n(630998),Gr=n.n(Ur),qr=n(84753),Kr=n.n(qr);function $r(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Qr(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Yr(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Qr(Object(n),!0).forEach((function(t){Xr(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Qr(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Xr(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}(0,Me.setObservableConfig)(Ae.Z);var Jr=function(e,t){var n=Gr()(e,{id:t});return e[-1!==n&&n?n:0]},eo=(0,Me.withProps)((function(e){var t=e.id,n=e.backgroundId,r=e.contents,o=Jr(void 0===r?[]:r,n)||{},i=o&&o.id;return{background:D()(o,"background")||{type:"none"},contentId:i,sectionId:t,path:'sections[{"id": "'.concat(t,'"}].contents[{"id": "').concat(i,'"}].background')}})),to=(0,Me.withHandlers)({updateBackground:function(e){var t=e.sectionId,n=e.contentId,r=e.update,o=void 0===r?function(){}:r;return function(e){for(var r=arguments.length,i=new Array(r>1?r-1:0),a=1;a<r;a++)i[a-1]=arguments[a];return o.apply(void 0,['sections[{"id": "'.concat(t,'"}].contents[{"id": "').concat(n,'"}].background.')+e].concat(i))}},updateSection:function(e){var t=e.sectionId,n=e.update,r=void 0===n?function(){}:n;return function(){for(var e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return r.apply(void 0,['sections[{"id": "'.concat(t,'"}]')].concat(n))}}}),no=(0,Me.compose)(eo,to),ro=(0,Me.mapPropsStream)((function(e){var t=(0,Me.createEventHandler)(),n=t.handler,r=t.stream;return m.Observable.combineLatest(e,function(e,t){var n=e.scan((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,n=t.id,r=t.visible,o=t.entry;return Yr(Yr({},e),{},Xr({},n,{visible:r,entry:o}))}),{}).debounceTime(100).map((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{maxItem:Kr()(Object.keys(e),(function(t){return e[t].visible?D()(e[t],"entry.intersectionRatio"):-1/0})),items:e}}));return m.Observable.merge(n.pluck("maxItem").distinctUntilChanged().map((function(e){return{backgroundId:e}})),n.map((function(e){var t=e.maxItem,n=e.items;return 0===D()(n[t],"entry.intersectionRatio")?"EMPTY":t})).withLatestFrom(t.pluck("updateCurrentPage")).do((function(e){var t,n,r=(n=2,function(e){if(Array.isArray(e))return e}(t=e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i=[],a=!0,c=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);a=!0);}catch(e){c=!0,o=e}finally{try{a||null==n.return||n.return()}finally{if(c)throw o}}return i}}(t,n)||function(e,t){if(e){if("string"==typeof e)return $r(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?$r(e,t):void 0}}(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),o=r[0],i=r[1];return i&&i({columnId:o})})).ignoreElements())}(r,e).startWith({}),(function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return Yr(Yr({},t.reduce((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;return Yr(Yr({},e),t)}),{})),{},{onVisibilityChange:n})}))}));const oo=(0,Me.compose)(ro,no);var io=n(689438);function ao(e){return ao="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ao(e)}function co(){return co=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},co.apply(this,arguments)}function lo(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function so(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?lo(Object(n),!0).forEach((function(t){vo(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):lo(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function uo(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function po(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function fo(e,t){return fo=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},fo(e,t)}function yo(e,t){if(t&&("object"===ao(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return bo(e)}function bo(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function mo(e){return mo=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},mo(e)}function vo(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var go=n(569334);function ho(e){return ho="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ho(e)}function Oo(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function wo(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Oo(Object(n),!0).forEach((function(t){ko(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Oo(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Eo(){return Eo=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Eo.apply(this,arguments)}function jo(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Po(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function So(e,t){return So=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},So(e,t)}function To(e,t){if(t&&("object"===ho(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function Co(e){return Co=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Co(e)}function ko(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Io=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&So(e,t)}(c,e);var t,n,r,o,a=(r=c,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Co(r);if(o){var n=Co(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return To(this,e)});function c(){return jo(this,c),a.apply(this,arguments)}return t=c,(n=[{key:"render",value:function(){var e=(0,d.cy)(this.props),t=!this.props.disableToolbarPortal&&this.refs&&this.refs.div&&this.refs.div.parentNode,n=this.props.sectionType===d.ID.TITLE?["editMedia","cover"]:["editMedia"],r=this.props.contentToolbar||Ar,o=i().createElement(r,Eo({},this.props,{themeProps:{disableBackgroundAlpha:!0,disableTextColor:!0,disableShadow:!0},tools:this.props.tools&&this.props.type&&this.props.tools[this.props.type]||this.props.sectionType===d.ID.BANNER&&[].concat(n,["cover","remove"])||n}),this.props.contentToolbarChildren),a="".concat(this.props.sectionId||"ms","-media-").concat(this.props.id||this.props.resourceId);return i().createElement("div",{ref:"div",className:"ms-section-background",style:wo({},this.props.style)},i().createElement("div",{className:"ms-section-background-container".concat((0,d.w)(this.props)),ref:this.props.innerRef,style:wo(wo({height:this.props.height},e),null!==Bt.Ln&&void 0!==Bt.Ln&&Bt.Ln[this.props.type]?{}:this.props.backgroundPlaceholder)},i().createElement(Bt.ZP,Eo({id:a},this.props,{enableFullscreen:!1,descriptionEnabled:!1,mediaViewer:this.props.mediaViewer,containerInView:this.props.inView}),this.props.children),this.props.mode===d.nl.EDIT&&(t?i().createElement(go.h_,{container:t},o):o)))}}])&&Po(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),c}(o.Component);ko(Io,"propTypes",{id:Ge().string,resourceId:Ge().string,sectionId:Ge().string,mode:Ge().string,fit:Ge().string,size:Ge().string,path:Ge().string,credits:Ge().string,description:Ge().string,height:Ge().number,width:Ge().number,tools:Ge().object,style:Ge().object,add:Ge().func,editMedia:Ge().func,update:Ge().func,updateSection:Ge().func,remove:Ge().func,type:Ge().oneOf(d.lg.MediaTypes),disableToolbarPortal:Ge().bool,backgroundPlaceholder:Ge().object,sectionType:Ge().string,src:Ge().string,theme:Ge().string,mediaViewer:Ge().func,contentToolbar:Ge().func,inView:Ge().bool,sections:Ge().array,innerRef:Ge().oneOfType([Ge().func,Ge().object]),contentToolbarChildren:Ge().node}),ko(Io,"defaultProps",{height:0,size:"full",width:0,style:{}});const Do=(Mo=Io,Ao=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&fo(e,t)}(c,e);var t,n,r,o,a=(r=c,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=mo(r);if(o){var n=mo(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return yo(this,e)});function c(){var e;uo(this,c);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return vo(bo(e=a.call.apply(a,[this].concat(n))),"state",{style:{}}),vo(bo(e),"update",(function(t){if(e._stickybits){var n=document.querySelector(t);-1===e._stickybits.definePosition().indexOf("sticky")&&n&&(e._stickybits.update(),setTimeout((function(){var t=n.getBoundingClientRect(),r=t.top,o=t.left;e.setState({style:{top:r,left:o,width:n.scrollWidth-2}})})))}})),e}return t=c,(n=[{key:"componentDidMount",value:function(){this._stickybits=this._node&&(0,io.Z)(this._node,{scrollEl:this.props.scrollContainerSelector,noStyles:!0,useGetBoundingClientRect:!0}),this.update(this.props.scrollContainerSelector)}},{key:"componentWillReceiveProps",value:function(e){!this._stickybits||e.viewWidth===this.props.viewWidth&&e.viewHeight===this.props.viewHeight||this.update(e.scrollContainerSelector)}},{key:"componentWillUnmount",value:function(){this._stickybits&&this._stickybits.cleanup()}},{key:"render",value:function(){var e=this;return i().createElement(Mo,co({ref:function(t){t&&t.refs&&t.refs[e.props.refId]&&(e._node=t.refs[e.props.refId])},style:so({},this.state.style)},this.props),this.props.children)}}])&&po(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),c}(o.Component),vo(Ao,"propTypes",{scrollContainerSelector:Ge().string,height:Ge().number,width:Ge().number,refId:Ge().string}),vo(Ao,"defaultProps",{scrollContainerSelector:"body",height:0,width:0,refId:"div"}),Ao);var Mo,Ao,xo=n(911636),No=n.n(xo);function Ro(){return Ro=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Ro.apply(this,arguments)}function Lo(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const Zo=(0,Me.compose)(oo,(0,Me.withStateHandlers)({textEditorActive:!1},{bubblingTextEditing:function(){return function(e){return{textEditorActiveClass:e?" ms-text-editor-active":""}}}}))((function(e){var t,n=e.add,r=void 0===n?function(){}:n,o=e.editMedia,a=void 0===o?function(){}:o,c=e.editWebPage,l=void 0===c?function(){}:c,s=e.onVisibilityChange,u=void 0===s?function(){}:s,p=e.update,f=void 0===p?function(){}:p,y=e.updateBackground,b=void 0===y?function(){}:y,m=e.updateCurrentPage,v=void 0===m?function(){}:m,g=e.remove,h=void 0===g?function(){}:g,O=e.id,w=e.background,E=void 0===w?{}:w,j=e.path,P=e.contents,S=void 0===P?[]:P,T=e.mode,C=e.sectionType,k=e.inViewRef,I=e.viewWidth,M=e.viewHeight,A=e.focusedContent,x=e.contentId,N=e.bubblingTextEditing,R=void 0===N?function(){}:N,L=e.textEditorActiveClass,Z=void 0===L?"":L,W=e.expandableMedia,B=void 0!==W&&W,_=e.storyTheme,V=e.mediaViewer,H=e.contentToolbar,F=e.inView,z=e.sections,U=void 0===z?[]:z,G=e.storyFonts,q=A&&A.hideContent&&D()(A,"target.id")===x,K=q?"hidden":"visible",$=B&&E&&"map"===E.type?" ms-expandable-background":"",Q=(null==_?void 0:_.overlay)||{},Y=(null==_?void 0:_.general)||{};return i().createElement("section",{className:"ms-section ms-section-immersive".concat($),id:O,ref:k},i().createElement(Do,Ro({},E,{mode:T,disableToolbarPortal:!0,tools:(t={},Lo(t,d.Tr.IMAGE,["editMedia","fit","size","align","theme"]),Lo(t,d.Tr.MAP,["editMedia","editMap","size","align","theme"]),Lo(t,d.Tr.VIDEO,["editMedia","fit","size","align","theme","muted","autoplay","loop"]),t),scrollContainerSelector:"#ms-sections-container",add:r,editMedia:a,expandable:B,path:j,update:b,updateCurrentPage:v,remove:h,sectionType:C,sectionId:O,backgroundId:E.id,key:E.id,width:I,height:M,backgroundPlaceholder:{background:"url(".concat(No(),")"),backgroundSize:"600px auto"},storyTheme:Y,mediaViewer:V,contentToolbar:H,inView:F})),i().createElement(zr,{tools:Lo({},d.bT.COLUMN,["size","align","theme"]),className:"ms-section-contents".concat(Z),contents:S,mode:T,add:r,updateCurrentPage:v,editMedia:a,editWebPage:l,update:f,remove:h,sectionId:O,viewWidth:I,viewHeight:M,contentProps:{onVisibilityChange:u,contentWrapperStyle:{minHeight:M,visibility:K},expandable:B,mediaViewer:V,contentToolbar:H},focusedContent:A,bubblingTextEditing:R,sectionType:C,storyTheme:Q,sections:U,storyFonts:G}),T===d.nl.EDIT&&!q&&i().createElement(Rn,{containerWidth:I,containerHeight:M,buttons:[{glyph:"story-title-section",tooltipId:"geostory.addTitleSection",onClick:function(){r("sections",O,d.ID.TITLE)}},{glyph:"story-banner-section",tooltipId:"geostory.addBannerSection",onClick:function(){r("sections",O,d.ID.BANNER)}},{glyph:"story-paragraph-section",tooltipId:"geostory.addParagraphSection",onClick:function(){r("sections",O,d.ID.PARAGRAPH)}},{glyph:"story-immersive-content",tooltipId:"geostory.addImmersiveContent",onClick:function(){r('sections[{"id": "'.concat(O,'"}].contents'),void 0,d.bT.COLUMN,"geostory.builder.defaults.titleImmersiveContent")}},{glyph:"story-carousel-section",tooltipId:"geostory.addGeocarouselSection",onClick:function(){r("sections",O,d.ID.CAROUSEL)}},{glyph:"story-media-section",tooltipId:"geostory.addMediaSection",onClick:function(){r("sections",O,d.tQ.MEDIA)}},{glyph:"story-webpage-section",tooltipId:"geostory.addWebPageSection",onClick:function(){r("sections",O,d.tQ.WEBPAGE)}}]}))}));function Wo(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Bo(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Wo(Object(n),!0).forEach((function(t){_o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Wo(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function _o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const Vo=function(e){var t=e.id,n=e.contents,r=e.mode,o=e.add,a=void 0===o?function(){}:o,c=e.update,l=void 0===c?function(){}:c,s=e.editMedia,u=void 0===s?function(){}:s,p=e.editWebPage,f=void 0===p?function(){}:p,y=e.remove,b=void 0===y?function(){}:y,m=e.inViewRef,v=e.viewWidth,g=e.viewHeight,h=e.expandableMedia,O=e.mediaViewer,w=e.contentToolbar,E=e.sections,j=void 0===E?[]:E,P=e.sectionType,S=e.storyFonts;return i().createElement("section",{className:"ms-section ms-section-paragraph",id:t,ref:m},i().createElement(zr,{className:"ms-section-contents",contents:n,mode:r,add:a,editMedia:u,editWebPage:f,update:l,remove:b,sectionId:t,viewWidth:v,viewHeight:g,sectionType:P,contentProps:{expandable:h,mediaViewer:O,contentToolbar:w,overrideTools:function(e){return Bo(Bo({},e),{},_o({},d.bT.TEXT,[(!0,{id:"size",filterOptions:function(e){return"full"!==e.value},pullRight:true}),"remove"]))}},sections:j,storyFonts:S}),r===d.nl.EDIT&&i().createElement(Rn,{containerWidth:v,containerHeight:g,buttons:[{glyph:"story-title-section",tooltipId:"geostory.addTitleSection",onClick:function(){a("sections",t,d.ID.TITLE)}},{glyph:"story-banner-section",tooltipId:"geostory.addBannerSection",onClick:function(){a("sections",t,d.ID.BANNER)}},{glyph:"story-paragraph-section",tooltipId:"geostory.addParagraphSection",onClick:function(){a("sections",t,d.ID.PARAGRAPH)}},{glyph:"story-immersive-section",tooltipId:"geostory.addImmersiveSection",onClick:function(){a("sections",t,d.ID.IMMERSIVE)}},{glyph:"story-carousel-section",tooltipId:"geostory.addGeocarouselSection",onClick:function(){a("sections",t,d.ID.CAROUSEL)}},{glyph:"story-media-section",tooltipId:"geostory.addMediaSection",onClick:function(){a("sections",t,d.tQ.MEDIA)}},{glyph:"story-webpage-section",tooltipId:"geostory.addWebPageSection",onClick:function(){a("sections",t,d.tQ.WEBPAGE)}}]}))};function Ho(){return Ho=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Ho.apply(this,arguments)}function Fo(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const zo=(0,Me.compose)(no,(0,Me.withStateHandlers)({textEditorActive:!1},{bubblingTextEditing:function(){return function(e){return{textEditorActiveClass:e?" ms-text-editor-active":""}}}}))((function(e){var t=e.id,n=e.background,r=void 0===n?{}:n,o=e.contents,a=void 0===o?[]:o,c=e.mode,l=e.contentId,s=e.path,u=e.sectionType,p=e.cover,f=e.viewWidth,y=e.viewHeight,b=e.inViewRef,m=e.add,v=void 0===m?function(){}:m,g=e.update,h=void 0===g?function(){}:g,O=e.updateSection,w=void 0===O?function(){}:O,E=e.remove,j=void 0===E?function(){}:E,P=e.updateBackground,S=void 0===P?function(){}:P,T=e.editMedia,C=void 0===T?function(){}:T,k=e.focusedContent,I=e.bubblingTextEditing,M=void 0===I?function(){}:I,A=e.textEditorActiveClass,x=void 0===A?"":A,N=e.expandableMedia,R=void 0!==N&&N,L=e.storyTheme,Z=e.mediaViewer,W=e.contentToolbar,B=e.inView,_=e.sections,V=void 0===_?[]:_,H=e.storyFonts,F=D()(k,"target.id")===l,z=F?"hidden":"visible",U=R&&r&&"map"===r.type?" ms-expandable-background":"",G=(null==L?void 0:L.overlay)||{},q=(null==L?void 0:L.general)||{};return i().createElement("section",{ref:b,className:"ms-section ms-section-title".concat(U),id:t},i().createElement(De.Z,null,(function(e){var t,n=e.height;return i().createElement(Do,Ho({},r,{scrollContainerSelector:"#ms-sections-container",key:r.id,mode:c,id:l,path:s,update:S,add:v,editMedia:C,expandable:R,updateSection:w,cover:p,remove:j,width:f,sectionType:u,tools:(t={},Fo(t,d.Tr.IMAGE,["editMedia","cover","fit","size","align","theme"]),Fo(t,d.Tr.MAP,["editMedia","cover","editMap","size","align","theme"]),Fo(t,d.Tr.VIDEO,["editMedia","cover","fit","size","align","theme","muted","autoplay","loop"]),t),height:n>=y?y:n,storyTheme:q,mediaViewer:Z,contentToolbar:W,inView:B}))})),i().createElement(zr,{className:"ms-section-contents".concat(x),contents:a,mode:c,add:v,sectionType:u,update:h,remove:j,sectionId:t,contentProps:{contentWrapperStyle:p?{minHeight:y,visibility:z}:{visibility:z},mediaViewer:Z,contentToolbar:W},tools:Fo({},d.bT.TEXT,["size","align","theme","remove"]),focusedContent:k,bubblingTextEditing:M,storyTheme:G,sections:V,storyFonts:H}),c===d.nl.EDIT&&!F&&i().createElement(Rn,{containerWidth:f,containerHeight:y,buttons:[{glyph:"story-title-section",tooltipId:"geostory.addTitleSection",onClick:function(){v("sections",t,d.ID.TITLE)}},{glyph:"story-banner-section",tooltipId:"geostory.addBannerSection",onClick:function(){v("sections",t,d.ID.BANNER)}},{glyph:"story-paragraph-section",tooltipId:"geostory.addParagraphSection",onClick:function(){v("sections",t,d.ID.PARAGRAPH)}},{glyph:"story-immersive-section",tooltipId:"geostory.addImmersiveSection",onClick:function(){v("sections",t,d.ID.IMMERSIVE)}},{glyph:"story-carousel-section",tooltipId:"geostory.addGeocarouselSection",onClick:function(){v("sections",t,d.ID.CAROUSEL)}},{glyph:"story-media-section",tooltipId:"geostory.addMediaSection",onClick:function(){v("sections",t,d.tQ.MEDIA)}},{glyph:"story-webpage-section",tooltipId:"geostory.addWebPageSection",onClick:function(){v("sections",t,d.tQ.WEBPAGE)}}]}))}));function Uo(){return Uo=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Uo.apply(this,arguments)}function Go(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const qo=(0,Me.compose)(no,(0,Me.withStateHandlers)({textEditorActive:!1}))((function(e){var t=e.id,n=e.background,r=void 0===n?{}:n,o=e.mode,a=e.contentId,c=e.path,l=e.sectionType,s=void 0===l?d.ID.BANNER:l,u=e.cover,p=e.viewWidth,f=e.viewHeight,y=e.inViewRef,b=e.add,m=void 0===b?function(){}:b,v=e.updateSection,g=void 0===v?function(){}:v,h=e.remove,O=void 0===h?function(){}:h,w=e.updateBackground,E=void 0===w?function(){}:w,j=e.editMedia,P=void 0===j?function(){}:j,S=e.focusedContent,T=e.expandableMedia,C=void 0!==T&&T,k=e.storyTheme,I=e.mediaViewer,M=e.contentToolbar,A=e.inView,x=D()(S,"target.id")===a,N=C&&r&&"map"===r.type?" ms-expandable-background":"",R=c.replace(".background","");return i().createElement("section",{ref:y,className:"ms-section ms-section-banner".concat(N),id:t},i().createElement(De.Z,null,(function(e){var t,n=e.height;return i().createElement(Do,Uo({},r,{scrollContainerSelector:"#ms-sections-container",key:r.id,mode:o,id:a,path:c,update:E,add:m,editMedia:P,expandable:C,updateSection:g,cover:u,remove:function(){return O(R)},width:p,sectionType:s,tools:(t={},Go(t,d.Tr.IMAGE,["editMedia","cover","fit","size","align","theme","remove"]),Go(t,d.Tr.MAP,["editMedia","cover","editMap","size","align","theme","remove"]),Go(t,d.Tr.VIDEO,["editMedia","cover","fit","size","align","theme","muted","autoplay","loop","remove"]),t),height:n>=f?f:n,storyTheme:k,mediaViewer:I,contentToolbar:M,inView:A}))})),i().createElement("div",{style:{minHeight:u?f:300,pointerEvents:"none"}}),o===d.nl.EDIT&&!x&&i().createElement(Rn,{containerWidth:p,containerHeight:f,buttons:[{glyph:"story-title-section",tooltipId:"geostory.addTitleSection",onClick:function(){m("sections",t,d.ID.TITLE)}},{glyph:"story-banner-section",tooltipId:"geostory.addBannerSection",onClick:function(){m("sections",t,d.ID.BANNER)}},{glyph:"story-paragraph-section",tooltipId:"geostory.addParagraphSection",onClick:function(){m("sections",t,d.ID.PARAGRAPH)}},{glyph:"story-immersive-section",tooltipId:"geostory.addImmersiveSection",onClick:function(){m("sections",t,d.ID.IMMERSIVE)}},{glyph:"story-carousel-section",tooltipId:"geostory.addGeocarouselSection",onClick:function(){m("sections",t,d.ID.CAROUSEL)}},{glyph:"story-media-section",tooltipId:"geostory.addMediaSection",onClick:function(){m("sections",t,d.tQ.MEDIA)}},{glyph:"story-webpage-section",tooltipId:"geostory.addWebPageSection",onClick:function(){m("sections",t,d.tQ.WEBPAGE)}}]}))}));var Ko=n(771335),$o=n(694745);function Qo(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i=[],a=!0,c=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);a=!0);}catch(e){c=!0,o=e}finally{try{a||null==n.return||n.return()}finally{if(c)throw o}}return i}}(e,t)||function(e,t){if(e){if("string"==typeof e)return Yo(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Yo(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Yo(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var Xo=(0,qe.Z)("placeholder")(Vt.FormControl);const Jo=function(e){var t,n,r,a=Qo((0,o.useState)([]),2),c=a[0],l=a[1],s=Qo((0,o.useState)({data:null==e||null===(t=e.thumbnail)||void 0===t?void 0:t.image}),2),u=s[0],d=s[1],p=Qo((0,o.useState)(null==e?void 0:e.title),2),f=p[0],y=p[1];return i().createElement($o.Z,{fitContent:!0,title:i().createElement(Ft.Z,{msgId:e.editing?"geostory.carouselEditTitle":"geostory.carouselAddTitle"}),show:!0,fade:!0,clickOutEnabled:!1,bodyClassName:"ms-flex modal-properties-container background-dialog",onClose:e.onClose,buttons:e.loading?[]:[{text:i().createElement(Ft.Z,{msgId:e.editing?"save":"backgroundDialog.add"}),bsStyle:"primary",onClick:function(){e.update("thumbnail",{image:u.data}),e.update("title",f),e.onClose()}}]},i().createElement(Vt.Form,{style:{width:"100%"}},(r={FORMAT:i().createElement(Ft.Z,{msgId:"map.errorFormat"}),SIZE:i().createElement(Ft.Z,{msgId:"map.errorSize"})},c.length>0?i().createElement("div",{className:"dropzone-errorBox alert-danger"},i().createElement("p",null,i().createElement(Ft.Z,{msgId:"map.error"})),c.map((function(e){return i().createElement("div",{id:"error"+e,key:"error"+e,className:"error"+e},r[e])}))):null),i().createElement(Ko.Z,{onUpdate:function(e,t){return d({data:e,url:t})},onError:function(e){return l(e)},message:i().createElement(Ft.Z,{msgId:"backgroundDialog.thumbnailMessage"}),suggestion:"",map:{newThumbnail:D()(u,"url")||(null===(n=e.thumbnail)||void 0===n?void 0:n.image)||"NODATA"}}),i().createElement(Vt.FormGroup,null,i().createElement(Vt.ControlLabel,null,i().createElement(Ft.Z,{msgId:"layerProperties.title"})),i().createElement(Xo,{value:f,placeholder:"backgroundDialog.titlePlaceholder",onChange:function(e){return y(e.target.value)}}))))};var ei=n(625311),ti=n(245567),ni=n(773723),ri=n.n(ni),oi=n(615402);const ii=function(e){return t=e.type,n="",r="","addMap"===t?(n="ms-carousel-map-info",r="geostory.carouselAddMapInfo"):"addMarker"===t?(n="ms-carousel-marker-info",r="geostory.carouselPlaceMarkerInfo"):(n="ms-carousel-add-info",r="geostory.carouselAddItemInfo"),i().createElement("div",{className:n},i().createElement(oi.Z,{msgId:r}));var t,n,r};var ai=n(81593),ci=["title","thumbnail","index","isSelected"],li=["onSort","sectionId","contents","onEnableDraw","isEditMap","isDrawEnabled"];function si(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ui(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?si(Object(n),!0).forEach((function(t){di(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):si(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function di(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function pi(){return pi=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},pi.apply(this,arguments)}function fi(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i=[],a=!0,c=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);a=!0);}catch(e){c=!0,o=e}finally{try{a||null==n.return||n.return()}finally{if(c)throw o}}return i}}(e,t)||function(e,t){if(e){if("string"==typeof e)return yi(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?yi(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function yi(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function bi(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var mi=(0,ei.Z)((function(e){var t=e.title,n=e.thumbnail,r=e.index,o=e.isSelected,a=bi(e,ci),c=i().createElement("div",{className:Ye()("ms-geo-carousel-item",{"ms-geo-carousel-item-selected":o}),onClick:a.onClick},i().createElement("div",{className:"ms-geo-carousel-item-inner-wrapper",style:{backgroundImage:"url(".concat((null==n?void 0:n.image)||ri(),")")}},i().createElement("span",{className:"ms-geo-carousel-item-inner"},t||"Item ".concat(r+1)),i().createElement("span",{className:"ms-geo-carousel-item-inner-index"},r+1)));return a.isDraggable&&a.connectDragSource?a.connectDragSource(c):c})),vi=(0,ti.Z)((function(e){var t=e.mode,n=e.add,r=e.update,a=void 0===r?function(){}:r,c=e.remove,l=e.sectionId,s=e.isMapBackground,u=e.contentId,p=e.items,f=e.contentToolbar,y=void 0===f?Ar:f,b=e.cardComponent,m=e.containerWidth,v=e.isDrawEnabled,g=e.onEnableDraw,h=e.isEditMap,O=e.innerRef,w=e.deltaSwipeSize,E=void 0===w?200:w,j=e.transition,P=void 0===j?300:j,S=e.style,T=e.controlStyle,C=fi((0,o.useState)(!1),2),k=C[0],I=C[1],D=fi((0,o.useState)(void 0),2),M=D[0],A=D[1],x=fi((0,o.useState)(""),2),R=x[0],L=x[1],Z=fi((0,o.useState)({}),2),W=Z[0],B=Z[1],_=(0,ai.Z)({direction:"horizontal",width:m,deltaScroll:E,transition:P},[p.length]),V=_.isStartControlActive,H=_.isEndControlActive,F=_.containerPropsHandlers,z=_.contentPropsHandlers,U=_.itemPropsHandlers,G=_.moveToDeltaSize,q=_.moveItemInViewById,K=t===d.nl.EDIT;(0,o.useEffect)((function(){u&&q(u,{margin:32})}),[u]);var $=!(s&&!Jn()(p,(function(e){var t;return 0===((null==e||null===(t=e.features)||void 0===t?void 0:t.length)||0)})));return i().createElement(i().Fragment,null,i().createElement("div",{ref:O,style:S,className:"ms-geo-carousel"},K&&1===p.length&&$&&!h&&i().createElement(ii,{type:"addInfo"}),h&&K&&v&&!!Jn()(p,(function(e){var t;return e.id===u&&0===((null==e||null===(t=e.features)||void 0===t?void 0:t.length)||0)}))&&i().createElement(ii,{type:"addMarker"}),K&&i().createElement(y,{addDisabled:$,add:n,editMap:h,remove:function(){return c('sections[{"id":"'.concat(l,'"}]'))},tools:["add","remove"]}),i().createElement("div",pi({},F(),{className:"ms-horizontal-menu"}),i().createElement("div",z(),p.map((function(e,t){var r=U({id:e.id,onClick:h?void 0:function(){a('sections[{"id":"'.concat(l,'"}].contents[{"id":"').concat(e.id,'"}].carouselToggle'),!0)}});return i().createElement("div",pi({key:t},r,{className:"ms-geo-carousel-item-wrapper",style:h?{pointerEvents:"none"}:{}}),K&&i().createElement(y,{editMap:h,markerDisabled:!s||(null==e?void 0:e.id)!==u,edit:function(t){t.stopPropagation(),function(e){A(null==e?void 0:e.id),I(!0),B(null==e?void 0:e.thumbnail),L(null==e?void 0:e.title)}(e)},remove:function(){var n,r,o,i;return o=null==e?void 0:e.id,i=0===t&&p.length>0?null===(n=p[t+1])||void 0===n?void 0:n.id:null===(r=p[t-1])||void 0===r?void 0:r.id,c('sections[{"id":"'.concat(l,'"}].contents[{"id":"').concat(o,'"}]')),void(u===o&&a('sections[{"id":"'.concat(l,'"}].contents[{"id":"').concat(i,'"}].hideContent'),!1))},forceDelBtnDisable:(null==e?void 0:e.id)===u,add:n,marker:function(t){t.stopPropagation(),g(e)},tools:["edit","remove","marker"]}),i().createElement(b,pi({key:t,index:t,items:p,update:a,sectionId:l,selectedId:u,isSelected:(null==e?void 0:e.id)===u},e)))}))),V&&i().createElement(Ht.Z,{className:"square-button-md no-border ms-geo-carousel-control",style:ui(ui({},T),{},{position:"absolute"}),onClick:function(){return G(E)}},i().createElement(Vt.Glyphicon,{glyph:"chevron-left"})),H&&i().createElement(Ht.Z,{className:"square-button-md no-border ms-geo-carousel-control",style:ui(ui({},T),{},{position:"absolute",right:0}),onClick:function(){return G(-E)}},i().createElement(Vt.Glyphicon,{glyph:"chevron-right"})))),k&&i().createElement(Jo,{title:R,thumbnail:W,update:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:M,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"replace",o=N()(e)?"":".".concat(e);a('sections[{"id":"'.concat(l,'"}].contents[{"id":"').concat(n,'"}]')+o,t,r)},onClose:function(){return I(!1)}}))}));const gi=function(e){var t=e.onSort,n=e.sectionId,r=e.contents,o=void 0===r?[]:r,a=e.onEnableDraw,c=void 0===a?function(){}:a,l=e.isEditMap,s=e.isDrawEnabled,u=bi(e,li);return i().createElement(vi,pi({containerId:n,isDraggable:u.mode===d.nl.EDIT,onSort:function(e,r,o,i){if(o.containerId===i.containerId){var a='sections[{ "id": "'.concat(n,'" }].contents[{"id":"').concat(i.id,'"}]'),c='sections[{ "id": "'.concat(n,'" }].contents'),l=e,s=Pr()();t(a,c,l,s,'sections[{ "id": "'.concat(n,'" }].contents[{"id":"').concat(s,'"}]'))}}},ui(ui({},u),{},{sectionId:n}),{cardComponent:mi,items:o.map((function(e){var t=e.id,n=e.thumbnail;return{id:t,thumbnail:void 0===n?{}:n,features:e.features,title:e.title}})),isDrawEnabled:s,onEnableDraw:c,isEditMap:l}))};var hi=n(743837),Oi=n(240986);const wi=function(e){var t=e.currentIndex,n=e.contents,r=void 0===n?[]:n,o=e.onTraverseCard,a=void 0===o?function(){}:o;return i().createElement(i().Fragment,null,i().createElement(Ht.Z,{className:"ms-carousel-slider left-arrow",disabled:0===t,onClick:function(){return a()}},i().createElement(Vt.Glyphicon,{style:{fontSize:22},glyph:"chevron-left"})),i().createElement(Ht.Z,{className:"ms-carousel-slider right-arrow",onClick:function(){return a("right")},disabled:t===r.length-1},i().createElement(Vt.Glyphicon,{style:{fontSize:22},glyph:"chevron-right"})))};function Ei(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i=[],a=!0,c=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);a=!0);}catch(e){c=!0,o=e}finally{try{a||null==n.return||n.return()}finally{if(c)throw o}}return i}}(e,t)||function(e,t){if(e){if("string"==typeof e)return ji(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ji(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ji(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Pi(){return Pi=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Pi.apply(this,arguments)}function Si(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Ti(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Si(Object(n),!0).forEach((function(t){Ci(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Si(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Ci(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const ki=(0,Me.compose)(ro,(function(e){return function(t){var n=Jr(t.contents||[],t.backgroundId)||{},r=n&&n.id,o=Yr(Yr({},t),{},{contentId:r,sectionId:t.id,path:'sections[{"id": "'.concat(t.id,'"}].background')});return i().createElement(e,o)}}),(function(e){return function(t){var n=Yr(Yr({},t),{},{updateBackground:function(e){for(var n=arguments.length,r=new Array(n>1?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];return t.update.apply(t,['sections[{"id": "'.concat(t.sectionId,'"}].background.')+e].concat(r))},updateSection:function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return t.update.apply(t,['sections[{"id": "'.concat(t.sectionId,'"}]')].concat(n))}});return i().createElement(e,n)}}),(function(e){return function(t){var n=Ei((0,o.useState)(""),2),r=n[0],a=n[1];return i().createElement(e,Pi({},t,{textEditorActiveClass:r,bubblingTextEditing:function(e){return a(e?" ms-text-editor-active":"")}}))}}))((function(e){var t,n,r,a=e.add,c=void 0===a?function(){}:a,l=e.editMedia,s=void 0===l?function(){}:l,u=e.editWebPage,p=void 0===u?function(){}:u,f=e.onVisibilityChange,y=void 0===f?function(){}:f,b=e.update,m=void 0===b?function(){}:b,v=e.updateBackground,g=void 0===v?function(){}:v,h=e.updateCurrentPage,O=void 0===h?function(){}:h,w=e.remove,E=void 0===w?function(){}:w,j=e.id,P=e.background,S=void 0===P?{}:P,T=e.path,C=e.contents,k=void 0===C?[]:C,I=e.mode,M=e.sectionType,A=e.inViewRef,x=e.viewWidth,N=e.viewHeight,R=e.focusedContent,L=e.contentId,Z=e.bubblingTextEditing,W=void 0===Z?function(){}:Z,B=e.textEditorActiveClass,_=void 0===B?"":B,V=e.expandableMedia,H=void 0!==V&&V,F=e.storyTheme,z=e.mediaViewer,U=e.contentToolbar,G=e.inView,q=e.sections,K=void 0===q?[]:q,$=e.storyFonts,Q=e.onSort,Y=void 0===Q?function(){}:Q,X=e.onEnableDraw,J=void 0===X?function(){}:X,ee=e.isDrawEnabled,te=e.defaultMarkerStyle,ne=void 0===te?{iconColor:"cyan",iconShape:"circle"}:te,re=e.highlightedMarkerStyle,oe=void 0===re?{iconColor:"green",iconShape:"circle"}:re,ie=(0,o.useRef)(),ae=(0,o.useRef)(),ce=(0,o.useRef)();function le(e,t){return t-(e.left+e.right)<128?{top:0,left:0,bottom:0,right:0}:e}var se=R&&R.hideContent&&D()(R,"target.id")===j,ue=se?"hidden":"visible",de=H&&S&&"map"===S.type?" ms-expandable-background":"",pe=Ti(Ti({},null==F?void 0:F.overlay),I===d.nl.VIEW&&{maxHeight:N-350,overflowY:"auto"})||{},fe=(null==F?void 0:F.general)||{},ye=N-(I===d.nl.EDIT?220:200),be=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=Jn()(k,{id:L})||{},n=t.contents,r=void 0===n?[]:n;return e.filter((function(e){return d.ID.CAROUSEL===M&&1===r.length?"remove"!==e:e}))},me=(null==S?void 0:S.type)===d.Tr.MAP,ve=(k.find((function(e){return e.id===L}))||{}).features,ge=void 0===ve?[]:ve,he=Gr()(k,(function(e){var t=e.id;return L===t})),Oe=(0,d.Yh)({id:j,contents:k.filter((function(e){return e.id!==L})),featureStyle:function(e){var t=e.content,n=e.feature;return(0,d.c0)(ne,k,t,L,n)}}),we=(0,d.Yh)({id:"".concat(j,"-highlighted"),contents:k.filter((function(e){return e.id===L})),featureStyle:function(e){var t=e.content,n=e.feature;return(0,d.c0)(oe,k,t,L,n)}});return i().createElement("section",{className:"ms-section ms-section-carousel".concat(de),id:j,ref:A},i().createElement(Do,Pi({},S,{mode:I,innerRef:ie,disableToolbarPortal:!0,tools:(t={},Ci(t,d.Tr.IMAGE,["editMedia","fit","size","align","theme"]),Ci(t,d.Tr.MAP,["editMedia","editMap","size","align","theme"].concat(ee?"closeDraw":[])),Ci(t,d.Tr.VIDEO,["editMedia","fit","size","align","theme","muted","autoplay","loop"]),t),scrollContainerSelector:"#ms-sections-container",add:c,editMedia:s,expandable:H,path:T,update:g,updateCurrentPage:O,remove:E,sectionType:M,sectionId:j,backgroundId:S.id,key:S.id,width:x,height:N,backgroundPlaceholder:{background:"url(".concat(No(),")"),backgroundSize:"600px auto"},storyTheme:fe,mediaViewer:z,contentToolbar:U,inView:G,layers:[Oe,we],isDrawEnabled:ee,onEnableDraw:J,contentToolbarChildren:!me&&I===d.nl.EDIT&&i().createElement(ii,{type:"addMap"})}),i().createElement(hi.Z,{active:ee,features:ge,method:"Point",onChange:function(e,t){m('sections[{"id":"'.concat(j,'"}].contents[{"id":"').concat(L,'"}].features'),t)}}),i().createElement(Oi.Z,{active:!(ee||null!=S&&S.editMap),geometry:null==ge||null===(n=ge[0])||void 0===n||null===(r=n.geometry)||void 0===r?void 0:r.coordinates,padding:function(){var e={top:0,left:0,bottom:0,right:0},t=ie.current&&ie.current.querySelector(".ms-media-map"),n=ae.current&&ae.current.querySelector("[id='".concat(L,"']"));if(t&&n){var r=ie.current.getBoundingClientRect()||{},o=t.getBoundingClientRect()||{},i=n.getBoundingClientRect()||{};if(ce.current){var a=ce.current.getBoundingClientRect()||{};e.bottom=r.height-(a.top-r.top)}var c=o.left-r.left,l=c+o.width,s=i.left-r.left,u=s+i.width;if(s>=c&&u<=l){var d=s-c,p=l-u;return p>=d?e.left=d+i.width:e.right=p+i.width,le(e,o.width)}if(u>=c&&u<=l)return e.left=u-c,le(e,o.width);if(s>=c&&s<=l)return e.right=l-s,le(e,o.width)}return e}(),fixedZoom:!0,duration:300})),i().createElement(zr,{innerRef:ae,tools:Ci({},d.bT.COLUMN,["size","align","theme"]),className:"ms-section-contents".concat(_),contents:k,mode:I,add:c,updateCurrentPage:O,editMedia:s,editWebPage:p,update:m,remove:E,sectionId:j,viewWidth:x,viewHeight:N,contentProps:{onVisibilityChange:y,contentWrapperStyle:{minHeight:ye,visibility:ue},expandable:H,mediaViewer:z,contentToolbar:U,overrideTools:function(e){return Object.fromEntries(Object.entries(e).map((function(e){var t=Ei(e,2),n=t[0],r=t[1];return[n,be(r)]})))}},focusedContent:R,bubblingTextEditing:W,sectionType:M,storyTheme:pe,sections:K,storyFonts:$}),i().createElement(gi,{innerRef:ce,style:null!=F&&F.overlay?Ti({},F.overlay):{},controlStyle:fe?Ti({},fe):{},sectionId:j,contentId:L,contents:k,update:m,remove:E,expandable:H,add:function(){return e=Ti(Ti({},(0,d.nq)(d.bT.COLUMN)),{},{title:"Item "+(k.length+1),background:{}}),c('sections[{"id": "'.concat(j,'"}].contents'),void 0,e,"geostory.builder.defaults.titleGeocarouselContent"),void m('sections[{"id":"'.concat(j,'"}].contents[{"id":"').concat(L,'"}].hideContent'),!0);var e},contentToolbar:U,mode:I,onSort:Y,isMapBackground:me,isEditMap:null==S?void 0:S.editMap,containerWidth:x,isDrawEnabled:ee,onEnableDraw:function(e){m('sections[{"id":"'.concat(j,'"}].background.editMap'),!0,"replace"),J({contentId:e.id,sectionId:j})}}),I===d.nl.VIEW&&!H&&i().createElement(wi,{currentIndex:he,contents:k,onTraverseCard:function(){var e,t,n,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"left";e="left"===r?null==k||null===(t=k[0===he?0:he-1])||void 0===t?void 0:t.id:null==k||null===(n=k[he===k.length-1?he:he+1])||void 0===n?void 0:n.id,m('sections[{"id":"'.concat(j,'"}].contents[{"id":"').concat(e,'"}].carouselToggle'),!0)}}),I===d.nl.EDIT&&!se&&i().createElement(Rn,{containerWidth:x,containerHeight:N,buttons:[{glyph:"story-title-section",tooltipId:"geostory.addTitleSection",onClick:function(){c("sections",j,d.ID.TITLE)}},{glyph:"story-banner-section",tooltipId:"geostory.addBannerSection",onClick:function(){c("sections",j,d.ID.BANNER)}},{glyph:"story-paragraph-section",tooltipId:"geostory.addParagraphSection",onClick:function(){c("sections",j,d.ID.PARAGRAPH)}},{glyph:"story-immersive-section",tooltipId:"geostory.addImmersiveSection",onClick:function(){return c("sections",j,d.ID.IMMERSIVE)}},{glyph:"story-carousel-section",tooltipId:"geostory.addGeocarouselSection",onClick:function(){c("sections",j,d.ID.CAROUSEL)}},{glyph:"story-media-section",tooltipId:"geostory.addMediaSection",onClick:function(){c("sections",j,d.tQ.MEDIA)}},{glyph:"story-webpage-section",tooltipId:"geostory.addWebPageSection",onClick:function(){c("sections",j,d.tQ.WEBPAGE)}}]}))}));function Ii(e){return Ii="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ii(e)}var Di;function Mi(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Ai(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function xi(e,t){return xi=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},xi(e,t)}function Ni(e,t){if(t&&("object"===Ii(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return Ri(e)}function Ri(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Li(e){return Li=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Li(e)}function Zi(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Wi=(Zi(Di={},d.ID.IMMERSIVE,Zo),Zi(Di,d.ID.CAROUSEL,ki),Zi(Di,d.ID.PARAGRAPH,Vo),Zi(Di,d.tQ.MEDIA,Vo),Zi(Di,d.tQ.WEBPAGE,Vo),Zi(Di,d.ID.TITLE,zo),Zi(Di,d.ID.BANNER,qo),Zi(Di,"UNKNOWN",(function(e){var t=e.type,n=e.inViewRef;return i().createElement("div",{ref:n,className:"ms-section ms-section-unknown"},"WARNING: unknown session of type ",t)})),Di),Bi=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&xi(e,t)}(c,e);var t,n,r,o,a=(r=c,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Li(r);if(o){var n=Li(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return Ni(this,e)});function c(){var e;Mi(this,c);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return Zi(Ri(e=a.call.apply(a,[this].concat(n))),"state",{height:0}),e}return t=c,(n=[{key:"render",value:function(){var e=Wi[this.props.type]||Wi.UNKNOWN;return i().createElement(e,{sectionType:this.props.type,id:this.props.id,add:this.props.add,update:this.props.update,inViewRef:this.props.inViewRef,editMedia:this.props.editMedia,expandableMedia:this.props.expandableMedia,editWebPage:this.props.editWebPage,updateCurrentPage:this.props.updateCurrentPage,remove:this.props.remove,mode:this.props.mode,cover:this.props.cover,contents:this.props.contents,viewWidth:this.props.viewWidth,viewHeight:this.props.viewHeight,focusedContent:this.props.focusedContent,storyTheme:this.props.storyTheme,mediaViewer:this.props.mediaViewer,contentToolbar:this.props.contentToolbar,inView:this.props.inView,sections:this.props.sections,storyFonts:this.props.storyFonts,onSort:this.props.onSort,isDrawEnabled:this.props.isDrawEnabled,background:this.props.background,onEnableDraw:this.props.onEnableDraw,defaultMarkerStyle:this.props.defaultMarkerStyle,highlightedMarkerStyle:this.props.highlightedMarkerStyle})}}])&&Ai(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),c}(i().Component);Zi(Bi,"propTypes",{id:Ge().string,type:Ge().oneOf(d.lg.SectionTypes),storyType:Ge().oneOf(d.lg.StoryTypes),add:Ge().func,update:Ge().func,editMedia:Ge().func,editWebPage:Ge().func,remove:Ge().func,updateCurrentPage:Ge().func,mode:Ge().oneOf(d.lg.Modes),contents:Ge().array,viewHeight:Ge().number,viewWidth:Ge().number,inViewRef:Ge().func,excludeClassName:Ge().string,cover:Ge().bool,focusedContent:Ge().object,expandableMedia:Ge().bool,storyTheme:Ge().object,mediaViewer:Ge().func,contentToolbar:Ge().func,inView:Ge().bool,sections:Ge().array,storyFonts:Ge().array,onSort:Ge().func,isDrawEnabled:Ge().bool,onEnableDraw:Ge().func,background:Ge().object,defaultMarkerStyle:Ge().object,highlightedMarkerStyle:Ge().object}),Zi(Bi,"defaultProps",{id:"",add:function(){},update:function(){},editMedia:function(){},editWebPage:function(){},updateCurrentPage:function(){},remove:function(){},onSort:function(){},storyType:d.Ln.CASCADE,viewHeight:0,viewWidth:0,mode:d.nl.VIEW,expandableMedia:!1,sections:[],storyFonts:[],onEnableDraw:function(){}});const _i=$n({threshold:[0,.25,.5,.75,1],rootMargin:"-200px 0px 0px 0px"})(Bi);function Vi(e){return Vi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Vi(e)}function Hi(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Fi(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function zi(e,t){return zi=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},zi(e,t)}function Ui(e,t){if(t&&("object"===Vi(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return Gi(e)}function Gi(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function qi(e){return qi=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},qi(e)}function Ki(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var $i=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&zi(e,t)}(c,e);var t,n,r,o,a=(r=c,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=qi(r);if(o){var n=qi(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return Ui(this,e)});function c(){var e;Hi(this,c);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return Ki(Gi(e=a.call.apply(a,[this].concat(n))),"getAdjustedSelector",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return e.replace(/#\d|^#-\d/g,(function(e,t){return t?"#\\"+t[1]+t[2]:"#\\3"+e[1]+" "}))})),Ki(Gi(e),"getFocusedTarget",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e.props.targets,n=e.props.padding,r=void 0===n?{}:n;return t.map((function(t){var n=t.selector,o=null;try{var i=window.document.querySelector(e.getAdjustedSelector(n));if(i){var a=i.getBoundingClientRect(),c=a.top,l=a.right,s=a.bottom,u=a.left;o={x:u-r,y:c-r,w:l-u+2*r,h:s-c+2*r}}}catch(e){console.warn(e)}finally{return o}})).filter((function(e){return e}))})),Ki(Gi(e),"getHolePath",(function(t){var n=t.x,r=t.y,o=t.w,i=t.h,a=e.props.borderRadius,c=void 0===a?8:a;return"M ".concat(n," ").concat(r+c," q 0 -").concat(c," ").concat(c," -").concat(c," h ").concat(o-2*c," q ").concat(c," 0 ").concat(c," ").concat(c," v ").concat(i-2*c," q 0 ").concat(c," -").concat(c," ").concat(c," h-").concat(o-2*c," q -").concat(c," 0 -").concat(c," -").concat(c," v-").concat(i-2*c)})),Ki(Gi(e),"getPath",(function(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.getFocusedTarget(),o="M 0 0 h ".concat(n," v ").concat(t," h -").concat(n," v -").concat(t),i=r.map(e.getHolePath);return o+i.join(" ")})),e}return t=c,(n=[{key:"render",value:function(){var e=this,t=this.props,n=t.onMaskClicked,r=t.stopEventsOnTargets,o=void 0!==r&&r,a=t.targets,c=this.getFocusedTarget(a.filter((function(e){var t=e.stopEventsOnTarget;return o||t})));return i().createElement("div",{style:{position:"fixed",height:"100vh",width:"100vw",top:0,left:0,zIndex:1e6,pointerEvents:"none"}},i().createElement(De.Z,null,(function(t){var r=t.width,o=t.height;return i().createElement("svg",{width:r,height:o,xmlns:"http://www.w3.org/2000/svg"},i().createElement("path",{d:e.getPath(o,r),fill:"rgba(0,0,0,0.7)",fillRule:"evenodd",pointerEvents:"visiblePainted",onClick:n}),c.map((function(t,n){return i().createElement("path",{key:n,d:e.getHolePath(t),fill:"transparent",pointerEvents:"visiblePainted"})})))})))}}])&&Fi(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),c}(i().Component);function Qi(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Yi(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Qi(Object(n),!0).forEach((function(t){Xi(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Qi(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Xi(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Ki($i,"propTypes",{targets:Ge().arrayOf(Ge().shape({selector:Ge().string,stopEventsOnTarget:Ge().bool})),padding:Ge().number,borderRadius:Ge().number,onMaskClicked:Ge().func,stopEventsOnTargets:Ge().bool}),Ki($i,"defaultProps",{targets:[],padding:0,borderRadius:8,onMaskClicked:function(){},stopEventsOnTargets:!1});var Ji=(0,We.Z)((function(e){var t=e.sections;return 0===(void 0===t?[]:t).length}),(function(e){var t=e.add,n=void 0===t?function(){}:t;return{iconFit:!1,style:{position:"relative",width:"50%",top:"50%",left:"50%",transform:"translate(-50%, -50%)"},glyph:"geostory",title:i().createElement(Ft.Z,{msgId:"geostory.emptyTitle"}),description:i().createElement(Ft.Z,{msgId:"geostory.emptyDescription"}),content:i().createElement(Rn,{addButtonClassName:"square-button-md",containerWidth:"100%",containerHeight:"100%",buttons:[{glyph:"story-title-section",tooltipId:"geostory.addTitleSection",onClick:function(){n("sections",0,d.ID.TITLE)}},{glyph:"story-banner-section",tooltipId:"geostory.addBannerSection",onClick:function(){n("sections",0,d.ID.BANNER)}},{glyph:"story-paragraph-section",tooltipId:"geostory.addParagraphSection",onClick:function(){n("sections",0,d.ID.PARAGRAPH)}},{glyph:"story-immersive-section",tooltipId:"geostory.addImmersiveContent",onClick:function(){n("sections",0,d.ID.IMMERSIVE)}},{glyph:"story-carousel-section",tooltipId:"geostory.addGeocarouselContent",onClick:function(){n("sections",0,d.ID.CAROUSEL)}},{glyph:"story-media-section",tooltipId:"geostory.addMediaSection",onClick:function(){n("sections",0,d.tQ.MEDIA)}},{glyph:"code",tooltipId:"geostory.addWebPageSection",onClick:function(){n("sections",0,d.tQ.WEBPAGE)}}]})}}))(De.Z),ea=function(e){var t=e.width;return e.mode===d.nl.EDIT?"":t<640?"sm":t>=640&&t<1024?"md":""};const ta=(0,Me.compose)(Ze,ze,function(e){var t=e.showFocusMask,n=void 0===t?function(){}:t,r=e.defaultTargets,o=void 0===r?{selector:".ms-geostory-map-editor"}:r,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},c=a.padding,l=void 0===c?0:c,s=a.borderRadius,u=void 0===s?8:s,d=a.stopEventsOnTargets,p=void 0!==d&&d,f=a.onMaskClicked,y=void 0===f?function(){}:f;return(0,Me.branch)(n,(function(e){return(0,Me.nest)((function(e){var t=e.focusedContent,n=e.children;return i().createElement(i().Fragment,null,n,i().createElement($i,{targets:[t,o],padding:l,borderRadius:u,stopEventsOnTargets:p,onMaskClicked:y}))}),e)}))}({showFocusMask:function(e){var t=e.focusedContent,n=(t=void 0===t?{}:t).target;return(void 0===n?{}:n).id}}))((function(e){var t=e.mode,n=void 0===t?d.nl.VIEW:t,r=e.sections,o=void 0===r?[]:r,a=e.add,c=void 0===a?function(){}:a,l=e.onVisibilityChange,s=void 0===l?function(){}:l,u=e.updateCurrentPage,p=void 0===u?function(){}:u,f=e.editMedia,y=void 0===f?function(){}:f,b=e.editWebPage,m=void 0===b?function(){}:b,v=e.update,g=void 0===v?function(){}:v,h=e.remove,O=void 0===h?function(){}:h,w=e.focusedContent,E=e.isContentFocused,j=void 0!==E&&E,P=e.getSize,S=void 0===P?ea:P,T=e.theme,C=void 0===T?{}:T,k=e.mediaViewer,I=e.contentToolbar,D=e.storyFonts,M=e.onSort,A=void 0===M?function(){}:M,x=e.isDrawEnabled,N=void 0!==x&&x,R=e.onEnableDraw,L=void 0===R?function(){}:R,Z=e.defaultMarkerStyle,W=e.highlightedMarkerStyle;return i().createElement(Ie.Z,{className:"ms-cascade-story ms-".concat(n)},i().createElement(Ji,{sections:o,add:c},(function(e){var t,r=e.width,a=e.height,l=S({width:r,height:a,mode:n}),u=l?" ms-".concat(l):"",d="sm"===l,f=C&&dr()(C)&&C||{};return i().createElement("div",{id:"ms-sections-container",className:"ms-sections-container".concat(u," ms-sections-hyperlinks"),style:Yi(Yi({},null==f?void 0:f.general),j&&{overflow:"hidden"})},(null==f||null===(t=f.link)||void 0===t?void 0:t.color)&&i().createElement("style",{dangerouslySetInnerHTML:{__html:"\n            .ms-sections-hyperlinks .ms-text-editor-main a,\n            .ms-sections-hyperlinks .ms-text-wrapper a,\n            .ms-sections-hyperlinks .ms-text-editor-main a:link,\n            .ms-sections-hyperlinks .ms-text-wrapper a:link,\n            .ms-sections-hyperlinks .ms-text-editor-main a:visited,\n            .ms-sections-hyperlinks .ms-text-wrapper a:visited,\n            .ms-sections-hyperlinks .ms-text-editor-main a:active,\n            .ms-sections-hyperlinks .ms-text-wrapper a:active {\n                color: ".concat(f.link.color,";\n                opacity: 1;\n            }\n            .ms-sections-hyperlinks .ms-text-editor-main a:hover,\n            .ms-sections-hyperlinks .ms-text-wrapper a:hover {\n                color: ").concat(f.link.color,";\n                opacity: 0.75;\n            }\n        ")}}),o.map((function(e){var t=e.contents,l=void 0===t?[]:t,u=e.id,b=e.type,v=e.cover,h=e.background;return i().createElement(_i,{focusedContent:w,onVisibilityChange:s,add:c,editMedia:y,expandableMedia:d,editWebPage:m,updateCurrentPage:p,update:g,remove:O,key:u,id:u,viewHeight:a,viewWidth:r,type:b,mode:n,contents:l,cover:v,storyTheme:f,mediaViewer:k,contentToolbar:I,sections:o,storyFonts:D,onSort:A,isDrawEnabled:N,onEnableDraw:L,background:h,defaultMarkerStyle:Z,highlightedMarkerStyle:W})})))})))}));var na=n(648860),ra=["id"];function oa(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function ia(){return ia=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},ia.apply(this,arguments)}function aa(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ca(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?aa(Object(n),!0).forEach((function(t){la(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):aa(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function la(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var sa=(0,lr.Z)(Qn.Z);const ua=(0,Me.compose)((0,a.connect)((0,c.P1)(U.jq,U.z7,(function(e,t){return{resources:e,isContentFocused:t}}))),(0,Me.withProps)((function(e){var t=e.resources,n=e.resourceId,r=e.map,o=void 0===r?{}:r,i=ca(ca({},o),{},{layers:(o.layers||[]).map((function(e){return e||void 0}))}),a=Jn()(t,{id:n})||{};return{map:(0,d.oH)(a.data,i)}})));var da=(0,Me.compose)((0,a.connect)((0,c.P1)(U.GC,(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{focusedEl:e}}))),(0,Me.withProps)((function(e){var t=e.focusedEl,n=(t=void 0===t?{}:t).resourceId,r=t.map;return{map:r||{},resourceId:n,disableReset:!r}}))),pa=(0,Me.withHandlers)({onChangeMap:function(e){var t=e.update,n=e.focusedContent,r=void 0===n?{}:n;return function(e,n){t("".concat(r.path,".map.").concat(e),n,"merge")}},onChange:function(e){var t=e.update,n=e.focusedContent,r=void 0===n?{}:n;return function(e,n){t(r.path+".".concat(e),n,"merge")}}}),fa=(0,Me.compose)((0,a.connect)(null,{toggleAdvancedEditing:$.$Z}),(0,Me.withHandlers)({toggleAdvancedEditing:function(e){var t=e.toggleAdvancedEditing,n=void 0===t?function(){}:t,r=e.map,o=void 0===r?{}:r;return function(){var e=o.id,t=function(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}(o,ra);n("inlineEditor",{data:t,id:e})}}})),ya=(0,Me.withHandlers)({toggleEditing:function(e){var t=e.editMap,n=e.update,r=e.focusedContent;return function(){return n(r.path+".editMap",!t)}},onReset:function(e){var t=e.update,n=e.focusedContent,r=(n=void 0===n?{}:n).path,o=void 0===r?"":r;return function(){t(o+".map",void 0)}}}),ba=function(e){return i().createElement(sa,ia({glyph:"repeat",bsStyle:"primary",className:"square-button-md no-border",tooltipId:"geostory.contentToolbar.resetMap",confirmTitle:i().createElement(Ft.Z,{msgId:"geostory.contentToolbar.resetMapConfirm"}),confirmContent:i().createElement(Ft.Z,{msgId:"geostory.contentToolbar.resetConfirmContent"})},e))},ma=(0,Me.compose)((0,Me.withProps)((function(e){var t=e.disableReset,n=e.onReset,r=void 0===n?function(){}:n;return{buttons:[{renderButton:i().createElement(ba,{disabled:t,onClick:r})}]}})),na.Z,(0,Me.withStateHandlers)((function(){return{editNode:void 0}}),{setEditNode:function(){return function(e){return{editNode:e}}},closeNodeEditor:function(){return function(){return{editNode:void 0}}}}),(0,Me.branch)((function(e){return!!e.editNode}),(0,Me.withProps)((function(e){var t=e.selectedNodes,n=void 0===t?[]:t,r=e.closeNodeEditor,o=void 0===r?function(){}:r;return{buttons:[{visible:1===n.length,tooltipId:"close",glyph:"1-close",onClick:o}]}})),(0,Me.withProps)((function(e){var t,n=e.selectedNodes,r=void 0===n?[]:n,o=e.setEditNode,i=void 0===o?function(){}:o,a=e.buttons,c=void 0===a?[]:a;return{buttons:[{visible:1===r.length,glyph:"wrench",tooltipId:"toc.toolLayerSettingsTooltip",onClick:function(){i(r[0])}}].concat((t=c,function(e){if(Array.isArray(e))return oa(e)}(t)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(t)||function(e,t){if(e){if("string"==typeof e)return oa(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?oa(e,t):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()))}})))),va=(0,Me.compose)((0,Me.withPropsOnChange)(["focusedContent"],(function(e){var t=e.map,n=e.focusedEl;return{contentMap:(n=void 0===n?{}:n).map,lastSavedMap:t}})),(0,Me.withPropsOnChange)(["map"],(function(e){var t=e.map,n=e.lastSavedMap;return{pendingChanges:!rr()(n,t)}}))),ga=(0,Me.compose)((0,Me.withProps)((function(e){var t=e.toggleEditing;return{CloseBtn:function(e){return i().createElement(Qn.Z,ia({onClick:t},e))}}}))),ha=(0,Me.mapPropsStream)((function(e){var t=(0,Me.createEventHandler)(),n=t.stream,r=t.handler;return e.pluck("map").distinctUntilChanged((function(e,t){return rr()(e,t)})).switchMap((function(e){return n.map((function(t){return{map:ca(ca({},e),t)}})).startWith({map:e})})).combineLatest(e,(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.map,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return ca(ca({},n),{},{onMapViewLocalChanges:r,map:t})}))})),Oa=function(e,t){return void 0!==e&&void 0!==t&&e.toFixed(12)-t.toFixed(12)==0},wa=(0,Me.withHandlers)({onMapViewChanges:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.update,n=e.editMap,r=void 0!==n&&n,o=e.onMapViewLocalChanges,i=e.map,a=(i=void 0===i?{}:i).center,c=void 0===a?{}:a,l=i.zoom,s=i.mapStateSource,u=i.resolution,d=i.resetPanAndZoom;return function(e){var n=e.center,i=void 0===n?{}:n,a=e.zoom,p=e.mapStateSource,f=e.resolution,y=Oa(c.x,i.x)&&Oa(c.y,i.y);!r||y&&l===a?d?t("map",{center:c,zoom:l,mapStateSource:s,resolution:u,resetPanAndZoom:!1},"merge"):o({center:i,zoom:a,mapStateSource:p,resolution:f}):t("map",{center:i,zoom:a,mapStateSource:Pr()(),resolution:f,resetPanAndZoom:!1},"merge")}}}),Ea=n(5993),ja=n(75927),Pa=n(651768),Sa=n(815135),Ta=["tabs","activeTab","width","setActiveTab"];function Ca(){return Ca=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Ca.apply(this,arguments)}function ka(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var Ia=(0,Sa.Z)(Vt.NavItem);var Da=n(979105),Ma=n(743129),Aa=n(145869),xa=n(487320),Na=(0,qe.Z)(["placeholder","options"])(Ma.ZP);const Ra=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.map,n=void 0===t?{zoomControl:!0,mapInfoControl:!1}:t,r=e.onChangeMap,o=void 0===r?function(){}:r,a=n&&n.mapOptions||{},c=(0,d.kn)({mapOptions:a,zoomControl:!!P()(n.zoomControl)||n.zoomControl,mapInfoControl:!P()(n.mapInfoControl)&&n.mapInfoControl});return i().createElement(Vt.Form,{className:"ms-geostory-map-controls"},i().createElement(Vt.FormGroup,null,i().createElement(Vt.ControlLabel,null,i().createElement(Ft.Z,{msgId:"geostory.mapEditor.zoom"})),i().createElement(Aa.Z,{onChange:function(){var e=!c.zoomControl;o("zoomControl",e),o("mapOptions.interactions",{doubleClickZoom:e,shiftDragZoom:e,pinchZoom:e})},className:"ms-geostory-map-controls-switch",checked:c.zoomControl}),i().createElement(Na,{options:[{label:"geostory.mapEditor.topLeft",value:"topLeft"},{label:"geostory.mapEditor.topRight",value:"topRight"},{label:"geostory.mapEditor.bottomLeft",value:"bottomLeft"},{label:"geostory.mapEditor.bottomRight",value:"bottomRight"}],wrapperStyle:{marginTop:"10px"},value:c.mapOptions&&c.mapOptions.zoomPosition||"topLeft",clearable:!1,disabled:!c.zoomControl,onChange:function(e){return o("mapOptions.zoomPosition",e&&e.value?e.value:"topLeft")},placeholder:"geostory.builder.settings.titlePlaceholder"})),i().createElement(Vt.FormGroup,null,i().createElement(Vt.ControlLabel,null,i().createElement(Ft.Z,{msgId:"geostory.mapEditor.pan"})),i().createElement(Aa.Z,{onChange:function(){var e=!(c.mapOptions&&c.mapOptions.interactions&&c.mapOptions.interactions.dragPan);o("mapOptions.interactions",{dragPan:e,keyboardPan:e})},className:"ms-geostory-map-controls-switch",checked:c.mapOptions&&c.mapOptions.interactions&&c.mapOptions.interactions.dragPan})),i().createElement(Vt.FormGroup,null,i().createElement(Vt.ControlLabel,null,i().createElement(Ft.Z,{msgId:"geostory.mapEditor.identify"})),i().createElement(Aa.Z,{onChange:function(){var e=!c.mapInfoControl;o("mapInfoControl",e)},className:"ms-geostory-map-controls-switch",checked:c.mapInfoControl}),c.mapInfoControl&&i().createElement(xa.Z,{disabled:!c.mapInfoControl,popoverMessage:"geostory.builder.settings.templateTooltip",infoFormat:c.mapOptions&&c.mapOptions.mapInfoFormat||"application/json",onInfoFormatChange:function(e){return o("mapOptions.mapInfoFormat",e)},selectProps:{wrapperStyle:{marginTop:10}}})))};var La=n(616701),Za=(0,Me.withProps)((function(e){return{tabs:e.tabs||[{id:"toc",titleId:"geostory.mapEditor.toc",tooltipId:"geostory.mapEditor.toc",glyph:"1-layer",visible:!0,Component:La.Z},{id:"settings",titleId:"geostory.mapEditor.settings",tooltipId:"geostory.mapEditor.settings",glyph:"wrench",visible:!0,Component:Ra}]}}));const Wa=(0,Me.compose)((0,Da.Z)("activeTab","setActiveTab","toc"),Za);var Ba=(0,Me.compose)(Pa.Z,(0,Me.withProps)((function(e){var t=e.selectedNode;return{title:t&&t.title}})),(0,Ea.Z)("title"))((function(e){var t=e.title,n=e.description;return i().createElement("div",{className:"text-center"},i().createElement("div",{className:"mapstore-step-title"},t),i().createElement("div",{className:"mapstore-step-description"},n))})),_a=(0,Pa.Z)(ja.Z),Va=Wa((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.tabs,n=void 0===t?[]:t,r=e.activeTab,o=(e.width,e.setActiveTab),a=void 0===o?function(){}:o,c=ka(e,Ta);return i().createElement("div",{key:"ms-geostory-map-settings-navbar",className:"ms-row-tab"},i().createElement("div",null,i().createElement(Vt.Nav,{bsStyle:"tabs",activeKey:r,justified:!0},n.map((function(e){return i().createElement(Ia,{key:"ms-tab-settings-"+e.id,tooltipId:e.tooltipId,eventKey:e.id,onClick:function(){return a(e.id)}},i().createElement(Vt.Glyphicon,{glyph:e.glyph}))})))),i().createElement("div",null,n.filter((function(e){return e.id&&e.id===r})).filter((function(e){return e.Component})).map((function(e){return i().createElement(e.Component,Ca({},c,{key:"ms-geostory-tab-settings-body-"+e.id}))}))))}));const Ha=(0,Me.branch)((function(e){var t=e.focusedContent;return(t=void 0===t?{}:t).path}),(0,Me.compose)((0,Me.defaultProps)({isFocused:!0,editMap:!0}),da,ua,va,pa,ya,fa,ma,ga))((function(e){var t=e.mode,n=void 0===t?d.nl.VIEW:t,r=e.isFocused,o=void 0!==r&&r,a=e.map,c=void 0===a?{}:a,l=e.onChange,s=void 0===l?function(){}:l,u=e.onChangeMap,p=void 0===u?function(){}:u,f=e.onNodeSelect,y=void 0===f?function(){}:f,b=e.selectedNodes,m=e.buttons,v=void 0===m?[]:m,g=e.editNode,h=e.closeNodeEditor,O=e.CloseBtn,w=void 0===O?function(){return null}:O,E=e.isDrawEnabled;return n===d.nl.EDIT&&o?i().createElement("div",{key:"left-column",style:{order:-1,width:400,position:"relative"}},!E&&i().createElement(Ie.Z,{className:"ms-geostory-map-editor",header:i().createElement("div",{className:"ms-geostory-map-editor-header text-center"},i().createElement(Vt.Row,null,i().createElement(Vt.Col,{md:12,className:"text-center",style:{overflow:"hidden",lineHeight:"52px"}},i().createElement(w,{glyph:"1-close",className:"pull-left on-close-btn square-button no-border ",tooltipId:"geostory.contentToolbar.closeMapEditing"}),i().createElement("div",{className:"mapstore-step-title"},i().createElement(Ft.Z,{msgId:"geostory.mapEditor.configureMapOptions"})))),i().createElement(jn.Z,{transitionProps:!1,btnGroupProps:{className:"ms-geostory-map-editor-toolbar"},btnDefaultProps:{className:"square-button-md no-border",bsStyle:"primary",noTooltipWhenDisabled:!0},buttons:v}))},!!g&&[i().createElement(Ba,{map:c,editNode:g}),i().createElement(_a,{closeNodeEditor:h,editNode:g,map:c,onChange:s})]||[i().createElement(Va,{map:c,onChange:s,onChangeMap:p,selectedNodes:b,onSelect:y})])):null}));var Fa=n(264721),za=n.n(Fa),Ua=n(916788),Ga=n(437034),qa=n(452826),Ka=n(624262);function $a(){return $a=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},$a.apply(this,arguments)}function Qa(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Ya(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Qa(Object(n),!0).forEach((function(t){Xa(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Qa(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Xa(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const Ja=function(e){var t=function(){return i().createElement("div",{className:"ms-media-error"},i().createElement(Vt.Glyphicon,{glyph:"exclamation-sign"}))},n=function(e){var t=e.style,n=void 0===t?{}:t;return i().createElement("div",{style:n,className:"ms-media-loader"},i().createElement(on.Z,{size:52}))};return function(r){var o={},a=r.sectionType;if((a===d.ID.PARAGRAPH||a===d.ID.IMMERSIVE||a===d.ID.CAROUSEL)&&r.type===d.Tr.IMAGE){var c=((null==r?void 0:r.imgHeight)||9)/((null==r?void 0:r.imgWidth)||16)*100;o={paddingTop:"".concat(c,"%")}}return r.lazy?i().createElement(rn,{key:r.loadingId,id:r.loadingId,debounceTime:r.debounceTime,loading:r.isLoading,onLoad:function(e){return r.onLoad(Ya(Ya({},r.loading),{},Xa({},e,!1)))},loaderComponent:n,loaderStyle:o},i().createElement(e,$a({},r,{type:r.type,loaderComponent:n,loaderStyle:o,errorComponent:t}))):i().createElement(e,$a({},r,{key:r.id,type:r.mediaType||r.type,loaderComponent:n,errorComponent:t}))}};var ec=n(507848),tc=n(819983),nc=n(323010),rc=["autoplay"],oc=["type"];function ic(){return ic=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},ic.apply(this,arguments)}function ac(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}function cc(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function lc(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?cc(Object(n),!0).forEach((function(t){sc(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):cc(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function sc(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var uc=(0,Me.branch)((function(e){return e.resourceId}),(0,Me.compose)((0,a.connect)((0,c.P1)(U.jq,(function(e){return{resources:e}}))),(0,Me.withProps)((function(e){var t=e.resources,n=e.resourceId;return(Jn()(t,{id:n})||{}).data}))),(0,We.Z)((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.src,n=void 0===t?"":t,r=e.sectionType;return!n&&r!==d.ID.TITLE&&!za()([d.ID.IMMERSIVE,d.ID.CAROUSEL],r)}),(function(){return{glyph:"picture"}})))(Ja(Ua.Z)),dc=(0,Me.compose)((0,Me.branch)((function(e){return e.resourceId}),ua),(0,Me.withProps)((function(e){var t=e.map,n=void 0===t?{}:t;return{map:lc(lc({},n),{},{layers:n.layers&&n.layers.map((function(e){if(e.tileMatrixSet&&n.sources){var t=(0,Ka.gv)(n.sources,e);return lc(lc({},e),t)}return e}))})}})),ec.Z,tc.Z,ha,wa,nc.dV)(Ja(Ga.Z)),pc={image:uc,map:dc,video:(0,Me.branch)((function(e){return e.resourceId}),(0,Me.compose)((0,a.connect)((0,c.P1)(U.jq,(function(e){return{resources:e}}))),(0,Me.withProps)((function(e){var t=e.resources,n=e.resourceId,r=e.autoplay,o=(Jn()(t,{id:n})||{}).data||{},i=o.autoplay;return lc(lc({},ac(o,rc)),{},{autoplay:void 0!==r?r:i})}))),(0,We.Z)((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.src,n=void 0===t?"":t,r=e.sectionType;return!n&&r!==d.ID.TITLE&&!za()([d.ID.IMMERSIVE,d.ID.CAROUSEL],r)}),(function(){return{glyph:"play"}})))(Ja(qa.Z))};const fc=function(e){var t=e.type,n=ac(e,oc),r=pc[t];return r?i().createElement(r,ic({type:t},n)):null};var yc=["resources"];function bc(){return bc=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},bc.apply(this,arguments)}const mc=(0,a.connect)((0,c.P1)(U.jq,(function(e){return{resources:e}})))((function(e){var t=e.resources,n=function(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}(e,yc);if(n.resourceId){var r=(Jn()(t,{id:n.resourceId})||{}).data||{};return i().createElement(Ar,bc({},r,n))}return i().createElement(Ar,n)}));var vc=["story","mode","onAdd","messages","fontFamilies","storyFonts","webFont","onUpdate","onBasicError","onUpdateMediaEditorSetting","mediaEditorSettings"];function gc(){return gc=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},gc.apply(this,arguments)}var hc=function(e){var t=e.story,n=e.mode,r=void 0===n?d.nl.VIEW:n,a=e.onAdd,c=e.messages,l=e.fontFamilies,u=void 0===l?[]:l,f=e.storyFonts,y=void 0===f?[]:f,b=e.webFont,m=void 0===b?s():b,v=e.onUpdate,g=void 0===v?function(){}:v,h=e.onBasicError,O=void 0===h?function(){}:h,w=e.onUpdateMediaEditorSetting,E=e.mediaEditorSettings,j=function(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}(e,vc),P=(0,o.useCallback)((function(e){return(0,p.S$)(c,e)}),[c]),S=function(e,t,n,r){return a(e,t,n,r?P(r):P)};return(0,o.useEffect)((function(){window.__geostory_interaction=function(e,t){"scrollTo"===e&&(0,d.M1)(t,{behavior:"smooth"})}}),[]),(0,o.useEffect)((function(){g("settings.theme.fontFamilies",u,"merge"),E&&w(E)}),[]),(0,o.useEffect)((function(){y.length>0&&y.filter((function(e){var t=e.src;return t&&!document.head.querySelector("link[href='".concat(t,"']"))})).length>0&&m.load((0,d.bm)(y,(function(){}),(function(){return O({message:"geostory.builder.settings.webFontLoadError"})})))}),[y]),i().createElement(Ie.Z,{className:"ms-geostory",columns:[i().createElement(Ha,gc({},j,{add:S,update:g,mode:r}))]},i().createElement(ta,gc({},t,j,{storyFonts:(0,d._R)(y),add:S,update:g,mode:r,mediaViewer:fc,contentToolbar:mc})))};hc.defaultProps={storyFonts:[],fontFamilies:[],onUpdateMediaEditorSetting:function(){}};const Oc=(0,u.rx)("GeoStory",{component:(0,a.connect)((0,c.zB)({mode:U.eK,story:U.Kg,messages:Ce.Ps,focusedContent:U.FW,isContentFocused:U.z7,theme:function(e){var t;return(null===(t=(0,U.TQ)(e))||void 0===t?void 0:t.theme)||{}},storyFonts:U.mm,isDrawEnabled:U.HB}),{onAdd:y.IH,onUpdate:y.Vx,updateCurrentPage:y.RZ,onUpdateSetting:y.m7,remove:y.Od,onSort:y.pB,editMedia:b.Ql,editWebPage:y.o2,onBasicError:f.d,onUpdateMediaEditorSetting:y.Fu,onEnableDraw:y.EE})(hc),reducers:{geostory:ke.Z},epics:r})},911636:(e,t,n)=>{e.exports=n.p+"world.svg"},773723:(e,t,n)=>{e.exports=n.p+"MapStore2/web/client/components/geostory/contents/carousel/img/default.jpg"}}]);